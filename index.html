<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=yes" />
  <title>FANTASYAS ¬∑ —è–∫ Facebook</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet" />
  <style>
    /* ===== –°–ò–°–¢–ï–ú–ê –ó–ú–Ü–ù–ù–ò–• ‚Äî Facebook 2026 ===== */
    :root {
      --bg-page: #f0f2f5;
      --bg-surface: #ffffff;
      --bg-secondary: #f7f8fa;
      --bg-hover: #e4e6eb;
      --text-primary: #050505;
      --text-secondary: #65676b;
      --text-link: #216fdb;
      --border: #e4e6eb;
      --border-light: #e4e6eb;
      --accent: #1b74e4;
      --accent-hover: #1a6ed8;
      --acgent-gradient: linear-gradient(145deg, #1b74e4, #0a5cbf);
      --shadow: 0 1px 2px rgba(0,0,0,0.05);
      --shadow-raised: 0 8px 20px rgba(0,0,0,0.06), 0 2px 4px rgba(0,0,0,0.04);
      --radius-sm: 8px;
      --radius-md: 10px;
      --radius-lg: 16px;
      --radius-full: 9999px;
      --transition: all 0.2s ease;
      --font-sans: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
    }

    body.light {
      --bg-page: #f0f2f5;
      --bg-surface: #ffffff;
      --bg-secondary: #f7f8fa;
      --bg-hover: #e4e6eb;
      --text-primary: #050505;
      --text-secondary: #65676b;
      --border: #e4e6eb;
      --accent: #1b74e4;
    }

    body.dark {
      --bg-page: #18191a;
      --bg-surface: #242526;
      --bg-secondary: #3a3b3c;
      --bg-hover: #4e4f50;
      --text-primary: #e4e6eb;
      --text-secondary: #b0b3b8;
      --border: #3e4042;
      --accent: #2374e1;
      --shadow-raised: 0 8px 20px rgba(0,0,0,0.4);
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: var(--font-sans);
      background: var(--bg-page);
      color: var(--text-primary);
      min-height: 100vh;
      overflow-x: hidden;
      transition: background 0.2s, color 0.2s;
      line-height: 1.5;
    }

    /* ===== –¢–û–ü-–ë–ê–† ‚Äî —è–∫ —É Facebook ===== */
    .top-bar {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      height: 60px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 20px;
      background: var(--bg-surface);
      border-bottom: 1px solid var(--border);
      z-index: 1000;
      box-shadow: var(--shadow);
    }

    .site-name {
      font-size: 1.8rem;
      font-weight: 800;
      background: linear-gradient(145deg, #1b74e4, #0a5cbf);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      letter-spacing: -0.5px;
    }

    /* –ê–≤–∞—Ç–∞—Ä–∫–∞ –≤ —Ç–æ–ø-–±–∞—Ä—ñ */
    .top-bar-avatar {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background-size: cover;
      background-position: center;
      cursor: pointer;
      border: 1px solid var(--border);
    }

    /* ===== –ë–£–†–ì–ï–† ‚Äî –º—ñ–Ω—ñ–º–∞–ª—ñ–∑–º ===== */
    .burger {
      position: relative;
      width: 28px;
      height: 20px;
      cursor: pointer;
    }

    .burger span {
      position: absolute;
      width: 100%;
      height: 3px;
      background: var(--text-primary);
      border-radius: var(--radius-full);
      transition: all 0.25s ease;
    }

    .burger span:nth-child(1) { top: 0; }
    .burger span:nth-child(2) { top: 8px; }
    .burger span:nth-child(3) { top: 16px; }

    .burger.active span:nth-child(1) {
      transform: rotate(45deg) translate(6px, 6px);
    }
    .burger.active span:nth-child(2) { opacity: 0; }
    .burger.active span:nth-child(3) {
      transform: rotate(-45deg) translate(6px, -6px);
    }

    /* ===== –°–ê–ô–î–ë–ê–† ‚Äî –ª—ñ–≤–µ –º–µ–Ω—é ===== */
    .sidebar {
      position: fixed;
      top: 60px;
      left: 0;
      width: 280px;
      height: calc(100% - 60px);
      background: var(--bg-surface);
      border-right: 1px solid var(--border);
      transform: translateX(-100%);
      transition: transform 0.3s cubic-bezier(0.08, 0.82, 0.17, 1);
      padding: 20px 12px;
      z-index: 900;
      overflow-y: auto;
    }

    .sidebar.active {
      transform: translateX(0);
    }

    .sidebar a {
      display: flex;
      align-items: center;
      gap: 16px;
      color: var(--text-primary);
      font-size: 1.05rem;
      font-weight: 600;
      padding: 12px 16px;
      border-radius: var(--radius-md);
      margin: 4px 0;
      transition: var(--transition);
      text-decoration: none;
      cursor: pointer;
    }

    .sidebar a:hover {
      background: var(--bg-hover);
    }

    .sidebar a i {
      width: 24px;
      text-align: center;
    }

    /* ===== –ë–ï–ö–î–†–û–ü ===== */
    .backdrop {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.3);
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.3s ease;
      z-index: 800;
    }

    .backdrop.active {
      opacity: 1;
      pointer-events: all;
    }

    /* ===== –û–°–ù–û–í–ù–ò–ô –ö–û–ù–¢–ï–ù–¢ ‚Äî 3 –∫–æ–ª–æ–Ω–∫–∏ —è–∫ —É FB ===== */
    .main-content {
      margin-top: 80px;
      padding: 20px 24px;
      transition: var(--transition);
      max-width: 1280px;
      margin-left: auto;
      margin-right: auto;
      width: 100%;
    }

    .section {
      display: none;
      animation: fbFade 0.3s ease;
    }

    .section.active {
      display: block;
    }

    @keyframes fbFade {
      from { opacity: 0.7; transform: translateY(8px); }
      to { opacity: 1; transform: translateY(0); }
    }

    /* ===== –õ–Ü–í–ê –ö–û–õ–û–ù–ö–ê (–ø—Ä–æ—Ñ—ñ–ª—å) ===== */
    .fb-left-col {
      display: none;
    }

    /* ===== –¶–ï–ù–¢–†–ê–õ–¨–ù–ê –ö–û–õ–û–ù–ö–ê ‚Äî –°–¢–†–Ü–ß–ö–ê ===== */
    .feed-container {
      max-width: 720px;
      margin: 0 auto;
    }

    /* –ë–ª–æ–∫ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –ø–æ—Å—Ç–∞ */
    .fb-create-post {
      background: var(--bg-surface);
      border-radius: var(--radius-lg);
      border: 1px solid var(--border);
      padding: 16px 20px;
      margin-bottom: 24px;
      box-shadow: var(--shadow);
      display: flex;
      flex-direction: column;
      gap: 16px;
    }

    .create-post-header {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .avatar {
      width: 48px;
      height: 48px;
      border-radius: 50%;
      background-size: cover;
      background-position: center;
      background-color: var(--bg-secondary);
      border: 1px solid var(--border);
    }

    .avatar.large {
      width: 72px;
      height: 72px;
    }

    .create-post-placeholder {
      flex: 1;
      background: var(--bg-secondary);
      border: 1px solid var(--border);
      border-radius: var(--radius-full);
      padding: 12px 18px;
      color: var(--text-secondary);
      font-weight: 500;
      cursor: pointer;
      transition: var(--transition);
    }

    .create-post-placeholder:hover {
      background: var(--bg-hover);
    }

    /* ===== –ü–û–°–¢–ò ===== */
    .feed {
      display: flex;
      flex-direction: column;
      gap: 20px;
    }

    .post {
      background: var(--bg-surface);
      border: 1px solid var(--border);
      border-radius: var(--radius-lg);
      padding: 20px 20px 16px;
      transition: var(--transition);
      animation: postFb 0.4s ease;
      box-shadow: var(--shadow);
    }

    @keyframes postFb {
      from { opacity: 0; transform: scale(0.98); }
      to { opacity: 1; transform: scale(1); }
    }

    .post-header {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 14px;
    }

    .post-author {
      font-weight: 700;
      font-size: 1.05rem;
      color: var(--text-primary);
    }

    .post-meta {
      color: var(--text-secondary);
      font-size: 0.8rem;
      margin-top: 2px;
    }

    .post-content {
      font-size: 1rem;
      line-height: 1.6;
      margin-bottom: 16px;
      padding: 0 0 8px;
    }

    .post-footer {
      display: flex;
      gap: 8px;
      margin-top: 12px;
      padding-top: 12px;
      border-top: 1px solid var(--border);
    }

    .post-footer button {
      flex: 1;
      background: none;
      border: none;
      color: var(--text-secondary);
      font-weight: 600;
      font-size: 0.95rem;
      padding: 10px 8px;
      border-radius: var(--radius-md);
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      transition: var(--transition);
      cursor: pointer;
    }

    .post-footer button:hover {
      background: var(--bg-hover);
      color: var(--text-primary);
    }

    .like-btn.liked {
      color: var(--accent) !important;
    }

    .favorite-btn.favorited {
      color: #ffb703 !important;
    }

    /* ===== –ö–û–ú–ï–ù–¢–ê–†–Ü ===== */
    .comments-section {
      margin-top: 16px;
      padding-top: 12px;
      border-top: 1px solid var(--border);
    }

    .comment {
      display: flex;
      gap: 10px;
      margin-bottom: 12px;
      padding: 8px 12px;
      background: var(--bg-secondary);
      border-radius: var(--radius-lg);
    }

    .comment-avatar {
      width: 32px;
      height: 32px;
      border-radius: 50%;
      background-size: cover;
    }

    .comment-content {
      flex: 1;
      font-size: 0.95rem;
    }

    .comment-author {
      font-weight: 700;
      margin-right: 6px;
    }

    .comment-input {
      display: flex;
      gap: 12px;
      margin-top: 16px;
      align-items: center;
    }

    .comment-input input {
      flex: 1;
      background: var(--bg-secondary);
      border: 1px solid var(--border);
      border-radius: var(--radius-full);
      padding: 12px 16px;
      color: var(--text-primary);
      outline: none;
    }

    .comment-input button {
      background: var(--accent);
      color: white;
      border: none;
      border-radius: var(--radius-full);
      padding: 10px 20px;
      font-weight: 600;
    }

    /* ===== –ü–†–ê–í–ê –ö–û–õ–û–ù–ö–ê ===== */
    .right-sidebar {
      display: none;
    }

    /* ===== –ü–†–û–§–Ü–õ–¨ ===== */
    .profile-cover {
      background: linear-gradient(145deg, #1b74e4, #0a5cbf);
      height: 200px;
      border-radius: var(--radius-lg) var(--radius-lg) 0 0;
      position: relative;
    }

    .profile-header-fb {
      background: var(--bg-surface);
      border-radius: 0 0 var(--radius-lg) var(--radius-lg);
      padding: 24px 28px;
      margin-bottom: 24px;
      border: 1px solid var(--border);
      display: flex;
      flex-wrap: wrap;
      align-items: flex-end;
      gap: 24px;
    }

    .profile-avatar-large {
      width: 120px;
      height: 120px;
      border-radius: 50%;
      border: 4px solid var(--bg-surface);
      margin-top: -60px;
      background-size: cover;
    }

    .profile-info h2 {
      font-size: 2rem;
      font-weight: 800;
    }

    .stats-fb {
      display: flex;
      gap: 32px;
      margin-top: 16px;
    }

    /* ===== –ù–ê–õ–ê–®–¢–£–í–ê–ù–ù–Ø ===== */
    .settings-fb {
      background: var(--bg-surface);
      border-radius: var(--radius-lg);
      border: 1px solid var(--border);
      padding: 28px;
    }

    /* ===== –ê–î–ê–ü–¢–ê–¶–Ü–Ø ===== */
    @media (min-width: 1024px) {
      .main-content {
        display: grid;
        grid-template-columns: 1fr 2fr 1fr;
        gap: 24px;
      }
      .fb-left-col, .right-sidebar {
        display: block;
        background: var(--bg-surface);
        border-radius: var(--radius-lg);
        padding: 20px;
        border: 1px solid var(--border);
        height: fit-content;
      }
      .section {
        grid-column: 2;
      }
    }

    /* –ï–º–æ–¥–∑—ñ-–ø—ñ–∫–µ—Ä */
    .emoji-picker {
      display: none;
      background: var(--bg-surface);
      border: 1px solid var(--border);
      border-radius: var(--radius-full);
      padding: 8px 16px;
      margin: 12px 0;
      gap: 16px;
      flex-wrap: wrap;
      box-shadow: var(--shadow-raised);
    }
    .emoji-picker span {
      font-size: 1.8rem;
      cursor: pointer;
      transition: 0.2s;
    }
    .emoji-picker span:hover { transform: scale(1.2); }
  </style>
</head>
<body class="dark">

<div class="top-bar">
  <div class="burger" id="burger"><span></span><span></span><span></span></div>
  <div class="site-name">FANTASYAS</div>
  <div class="top-bar-avatar" id="topBarAvatar" style="background-image:url('');"></div>
</div>

<nav class="sidebar" id="sidebar">
  <a data-section="home"><i>üè†</i> –ì–æ–ª–æ–≤–Ω–∞</a>
  <a data-section="profile"><i>üë§</i> –ü—Ä–æ—Ñ—ñ–ª—å</a>
  <a data-section="settings"><i>‚öôÔ∏è</i> –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è</a>
  <a href="#"><i>‚ÑπÔ∏è</i> –ü—Ä–æ –Ω–∞—Å</a>
  <a href="#"><i>üíº</i> –ü–æ—Å–ª—É–≥–∏</a>
  <a href="#"><i>üñºÔ∏è</i> –ü–æ—Ä—Ç—Ñ–æ–ª—ñ–æ</a>
  <a href="#"><i>üìû</i> –ö–æ–Ω—Ç–∞–∫—Ç–∏</a>
</nav>

<div class="backdrop" id="backdrop"></div>

<main class="main-content">
  
  <!-- –õ—ñ–≤–∞ –∫–æ–ª–æ–Ω–∫–∞ (—Ç—ñ–ª—å–∫–∏ –¥–µ—Å–∫—Ç–æ–ø) -->
  <div class="fb-left-col">
    <div style="display:flex; gap:12px; align-items:center; margin-bottom:20px;">
      <div class="avatar" id="leftAvatar" style="background-image:url('');"></div>
      <div>
        <div style="font-weight:700;" id="leftUsername">–ì—ñ—Å—Ç—å</div>
        <div style="color:var(--text-secondary); font-size:0.9rem;">–ê–∫–∞—É–Ω—Ç</div>
      </div>
    </div>
    <div class="sidebar" style="position:static; transform:none; border:none; padding:0; background:transparent;">
      <a data-section="home"><i>üè†</i> –ì–æ–ª–æ–≤–Ω–∞</a>
      <a data-section="profile"><i>üë§</i> –ü—Ä–æ—Ñ—ñ–ª—å</a>
      <a data-section="settings"><i>‚öôÔ∏è</i> –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è</a>
    </div>
  </div>

  <!-- ===== –¶–ï–ù–¢–†–ê–õ–¨–ù–ê –ö–û–õ–û–ù–ö–ê ===== -->
  <div id="home" class="section active">
    <div class="feed-container">
      
      <!-- –ë–ª–æ–∫ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –ø–æ—Å—Ç–∞ -->
      <div class="fb-create-post" id="newPostBox" style="display:none;">
        <div class="create-post-header">
          <div class="avatar" id="postAvatar" style="background-image:url('');"></div>
          <div class="create-post-placeholder" id="openPostInput">–©–æ —É –≤–∞—Å –Ω–æ–≤–æ–≥–æ?</div>
        </div>
        <div id="postInputContainer" style="display:none;">
          <textarea id="postText" rows="3" placeholder="–†–æ–∑–∫–∞–∂—ñ—Ç—å, —â–æ —É –≤–∞—Å –Ω–∞ –¥—É–º—Ü—ñ..." style="width:100%; background:var(--bg-secondary); border:1px solid var(--border); border-radius:var(--radius-md); padding:16px; color:var(--text-primary); margin-bottom:12px;"></textarea>
          <div style="display:flex; justify-content:flex-end;">
            <button id="addPost" style="background:var(--accent); color:white; border:none; border-radius:var(--radius-full); padding:10px 24px; font-weight:600;">–û–ø—É–±–ª—ñ–∫—É–≤–∞—Ç–∏</button>
          </div>
        </div>
      </div>

      <!-- –õ–æ–≥—ñ–Ω –±–æ–∫—Å -->
      <div class="fb-create-post" id="loginBox">
        <div style="display:flex; gap:12px; align-items:center;">
          <div class="avatar"></div>
          <input type="text" id="usernameInput" placeholder="–í–≤–µ–¥—ñ—Ç—å —ñ–º'—è" style="flex:1; background:var(--bg-secondary); border:1px solid var(--border); border-radius:var(--radius-full); padding:14px 18px;">
          <button id="saveUsername" style="background:var(--accent); color:white; border:none; border-radius:var(--radius-full); padding:12px 24px;">–ü–æ—á–∞—Ç–∏</button>
        </div>
      </div>

      <!-- –°—Ç—Ä—ñ—á–∫–∞ –ø–æ—Å—Ç—ñ–≤ -->
      <div class="feed" id="feed"></div>
    </div>
  </div>

  <!-- –ü–†–û–§–Ü–õ–¨ (Facebook Style) -->
  <div id="profile" class="section">
    <div class="profile-cover"></div>
    <div class="profile-header-fb">
      <div class="profile-avatar-large" id="profileAvatar" style="background-image:url('');"></div>
      <div class="profile-info">
        <h2 id="profileUsernameDisplay">FANTASYAS</h2>
        <div style="color:var(--text-secondary); margin-top:4px;">–ó–∞—Ä–µ—î—Å—Ç—Ä–æ–≤–∞–Ω–∏–π: <span id="registerDate"></span></div>
        <div style="margin-top:12px;" id="profileBio">–û–ø–∏—Å –≤—ñ–¥—Å—É—Ç–Ω—ñ–π</div>
        <div class="stats-fb">
          <div><strong id="postCount">0</strong> –ø–æ—Å—Ç—ñ–≤</div>
          <div><strong id="likeCount">0</strong> –ª–∞–π–∫—ñ–≤</div>
          <div><strong id="favoriteCount">0</strong> –æ–±—Ä–∞–Ω–µ</div>
        </div>
        <div style="display:flex; gap:12px; margin-top:24px;">
          <input type="file" id="avatarFileInput" accept="image/*" style="display:none;">
          <button id="changeAvatarBtn" style="background:var(--bg-secondary); border:1px solid var(--border); border-radius:var(--radius-full); padding:10px 20px;">–ó–º—ñ–Ω–∏—Ç–∏ –∞–≤–∞—Ç–∞—Ä</button>
          <button id="editProfileBtn" style="background:var(--accent); color:white; border:none; border-radius:var(--radius-full); padding:10px 24px;">–†–µ–¥–∞–≥—É–≤–∞—Ç–∏</button>
        </div>
      </div>
    </div>
    <h3 style="margin:28px 0 16px; font-weight:700;">–ú–æ—ó –ø—É–±–ª—ñ–∫–∞—Ü—ñ—ó</h3>
    <div class="feed" id="profilePosts"></div>
  </div>

  <!-- –ù–ê–õ–ê–®–¢–£–í–ê–ù–ù–Ø -->
  <div id="settings" class="section">
    <div class="settings-fb">
      <h2 style="font-size:1.8rem; font-weight:700; margin-bottom:28px;">–ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è</h2>
      <div style="display:flex; flex-direction:column; gap:24px;">
        <div>
          <label style="font-weight:600;">üåó –¢–µ–º–∞</label>
          <select id="themeSelect" style="margin-top:8px; width:100%; padding:14px; background:var(--bg-secondary); border:1px solid var(--border); border-radius:var(--radius-md); color:var(--text-primary);">
            <option value="dark">–¢–µ–º–Ω–∞</option>
            <option value="light">–°–≤—ñ—Ç–ª–∞</option>
          </select>
        </div>
        <div>
          <label style="font-weight:600;">üî† –†–æ–∑–º—ñ—Ä —à—Ä–∏—Ñ—Ç—É</label>
          <select id="fontSizeSelect" style="margin-top:8px; width:100%; padding:14px; background:var(--bg-secondary); border:1px solid var(--border); border-radius:var(--radius-md); color:var(--text-primary);">
            <option value="normal">–ó–≤–∏—á–∞–π–Ω–∏–π</option>
            <option value="large">–í–µ–ª–∏–∫–∏–π</option>
          </select>
        </div>
        <button id="clearAllData" class="danger-btn" style="background:#dc3545; color:white; border:none; border-radius:var(--radius-full); padding:14px; font-weight:700; margin-top:20px;">–û—á–∏—Å—Ç–∏—Ç–∏ –≤—Å—ñ –¥–∞–Ω—ñ</button>
      </div>
    </div>
  </div>

  <!-- –ü—Ä–∞–≤–∞ –∫–æ–ª–æ–Ω–∫–∞ -->
  <div class="right-sidebar">
    <div style="font-weight:700; margin-bottom:16px;">–í–∞—à—ñ —Å—Ç–æ—Ä—ñ–Ω–∫–∏</div>
    <div style="display:flex; gap:12px; align-items:center; padding:12px; background:var(--bg-hover); border-radius:var(--radius-md);">
      <div class="avatar" style="background-image:url('');"></div>
      <span>FANTASYAS</span>
    </div>
  </div>
</main>

<!-- –ú–æ–¥–∞–ª—å —Ä–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è –ø—Ä–æ—Ñ—ñ–ª—é -->
<div class="modal" id="editProfileModal" style="display:none; position:fixed; top:50%; left:50%; transform:translate(-50%,-50%); background:var(--bg-surface); border-radius:var(--radius-lg); padding:32px; z-index:2000; width:90%; max-width:450px; border:1px solid var(--border); box-shadow:var(--shadow-raised);">
  <h3 style="margin-bottom:24px;">–†–µ–¥–∞–≥—É–≤–∞—Ç–∏ –ø—Ä–æ—Ñ—ñ–ª—å</h3>
  <div style="display:flex; flex-direction:column; gap:20px;">
    <input type="file" id="editAvatarFile" accept="image/*">
    <textarea id="editBio" rows="3" placeholder="–ë—ñ–æ–≥—Ä–∞—Ñ—ñ—è..." style="background:var(--bg-secondary); border:1px solid var(--border); border-radius:var(--radius-md); padding:16px; color:var(--text-primary);"></textarea>
    <div style="display:flex; gap:12px;">
      <button id="saveProfileBtn" style="background:var(--accent); color:white; border:none; border-radius:var(--radius-full); padding:12px 24px;">–ó–±–µ—Ä–µ–≥—Ç–∏</button>
      <button id="closeModalBtn" style="background:var(--bg-secondary); border:1px solid var(--border); border-radius:var(--radius-full); padding:12px 24px;">–°–∫–∞—Å—É–≤–∞—Ç–∏</button>
    </div>
  </div>
</div>

<script>
  (function() {
    const KEY = {
      USERNAME: 'fantasyasUsername',
      USER: 'fantasyasUserData',
      POSTS: 'fantasyas_posts_v4'
    };

    let username = localStorage.getItem(KEY.USERNAME);
    let userData = JSON.parse(localStorage.getItem(KEY.USER)) || {
      avatar: '',
      bio: '',
      registered: new Date().toISOString().split('T')[0],
      favorites: []
    };
    let posts = JSON.parse(localStorage.getItem(KEY.POSTS)) || [];

    // DOM –µ–ª–µ–º–µ–Ω—Ç–∏
    const burger = document.getElementById('burger');
    const sidebar = document.getElementById('sidebar');
    const backdrop = document.getElementById('backdrop');
    const sections = document.querySelectorAll('.section');
    const loginBox = document.getElementById('loginBox');
    const newPostBox = document.getElementById('newPostBox');
    const feed = document.getElementById('feed');
    const postText = document.getElementById('postText');
    const modal = document.getElementById('editProfileModal');

    // –ë—É—Ä–≥–µ—Ä
    burger.addEventListener('click', () => {
      burger.classList.toggle('active');
      sidebar.classList.toggle('active');
      backdrop.classList.toggle('active');
    });

    backdrop.addEventListener('click', () => {
      burger.classList.remove('active');
      sidebar.classList.remove('active');
      backdrop.classList.remove('active');
    });

    // –ù–∞–≤—ñ–≥–∞—Ü—ñ—è
    function showSection(id) {
      sections.forEach(s => s.classList.remove('active'));
      document.getElementById(id)?.classList.add('active');
      sidebar.classList.remove('active');
      burger.classList.remove('active');
      backdrop.classList.remove('active');
      if (id === 'profile') updateProfileUI();
      if (id === 'home') renderPosts();
    }

    document.querySelectorAll('[data-section]').forEach(el => {
      el.addEventListener('click', () => showSection(el.dataset.section));
    });

    // –¢–µ–º–∞/—à—Ä–∏—Ñ—Ç
    function applyPref() {
      const theme = localStorage.getItem('fantasyasTheme') || 'dark';
      const font = localStorage.getItem('fantasyasFontSize') || 'normal';
      document.body.className = theme;
      if (font === 'large') document.body.classList.add('large-font');
      const themeSelect = document.getElementById('themeSelect');
      const fontSizeSelect = document.getElementById('fontSizeSelect');
      if (themeSelect) themeSelect.value = theme;
      if (fontSizeSelect) fontSizeSelect.value = font;
    }
    applyPref();

    document.getElementById('themeSelect')?.addEventListener('change', (e) => {
      localStorage.setItem('fantasyasTheme', e.target.value);
      applyPref();
    });
    document.getElementById('fontSizeSelect')?.addEventListener('change', (e) => {
      localStorage.setItem('fantasyasFontSize', e.target.value);
      applyPref();
    });

    // –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—è
    if (username) {
      loginBox.style.display = 'none';
      newPostBox.style.display = 'block';
    } else {
      newPostBox.style.display = 'none';
    }

    document.getElementById('saveUsername').addEventListener('click', () => {
      const val = document.getElementById('usernameInput').value.trim();
      if (!val) return alert('–í–≤–µ–¥—ñ—Ç—å —ñ–º‚Äô—è');
      username = val;
      localStorage.setItem(KEY.USERNAME, username);
      if (!userData.registered) userData.registered = new Date().toISOString().split('T')[0];
      localStorage.setItem(KEY.USER, JSON.stringify(userData));
      loginBox.style.display = 'none';
      newPostBox.style.display = 'block';
      renderPosts();
      updateProfileUI();
      updateAvatars();
    });

    // –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∞–≤–∞—Ç–∞—Ä—ñ–≤
    function updateAvatars() {
      const avatarElements = document.querySelectorAll('.avatar, .top-bar-avatar, .profile-avatar-large');
      avatarElements.forEach(el => {
        if (el.id !== 'profileAvatar') el.style.backgroundImage = userData.avatar ? `url('${userData.avatar}')` : '';
      });
      document.getElementById('topBarAvatar').style.backgroundImage = userData.avatar ? `url('${userData.avatar}')` : '';
      document.getElementById('profileAvatar').style.backgroundImage = userData.avatar ? `url('${userData.avatar}')` : '';
      document.getElementById('leftUsername').innerHTML = username || '–ì—ñ—Å—Ç—å';
      document.getElementById('leftAvatar').style.backgroundImage = userData.avatar ? `url('${userData.avatar}')` : '';
      document.getElementById('postAvatar').style.backgroundImage = userData.avatar ? `url('${userData.avatar}')` : '';
    }

    // –ü–æ–ª–µ –≤–≤–æ–¥—É –ø–æ—Å—Ç–∞
    document.getElementById('openPostInput')?.addEventListener('click', () => {
      document.getElementById('postInputContainer').style.display = 'block';
    });

    // –î–æ–¥–∞–≤–∞–Ω–Ω—è –ø–æ—Å—Ç–∞
    document.getElementById('addPost').addEventListener('click', () => {
      const text = postText.value.trim();
      if (!text || !username) return;
      posts.unshift({
        id: Date.now(),
        username,
        text,
        likes: 0,
        likedBy: [],
        comments: [],
        reactions: { "‚ù§Ô∏è":0, "üî•":0, "üòÇ":0, "üòÆ":0 },
        created: new Date().toISOString()
      });
      localStorage.setItem(KEY.POSTS, JSON.stringify(posts));
      postText.value = '';
      document.getElementById('postInputContainer').style.display = 'none';
      renderPosts();
    });

    // –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –∞–≤–∞—Ç–∞—Ä–∞
    function handleAvatarUpload(inputEl, isModal = false) {
      inputEl?.addEventListener('change', (e) => {
        const file = e.target.files[0];
        if (!file) return;
        if (file.size > 3 * 1024 * 1024) {
          alert('–§–∞–π–ª –∑–∞–≤–µ–ª–∏–∫–∏–π (–º–∞–∫—Å 3 –ú–ë)');
          e.target.value = '';
          return;
        }
        const reader = new FileReader();
        reader.onload = (ev) => {
          userData.avatar = ev.target.result;
          localStorage.setItem(KEY.USER, JSON.stringify(userData));
          updateProfileUI();
          renderPosts();
          updateAvatars();
          if (isModal) modal.style.display = 'none';
          alert('–ê–≤–∞—Ç–∞—Ä –æ–Ω–æ–≤–ª–µ–Ω–æ');
        };
        reader.readAsDataURL(file);
      });
    }

    handleAvatarUpload(document.getElementById('avatarFileInput'));
    handleAvatarUpload(document.getElementById('editAvatarFile'), true);

    document.getElementById('changeAvatarBtn')?.addEventListener('click', () => {
      document.getElementById('avatarFileInput').click();
    });

    // –†–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è –ø—Ä–æ—Ñ—ñ–ª—é
    document.getElementById('editProfileBtn')?.addEventListener('click', () => {
      document.getElementById('editBio').value = userData.bio || '';
      modal.style.display = 'block';
    });

    document.getElementById('saveProfileBtn')?.addEventListener('click', () => {
      userData.bio = document.getElementById('editBio').value.trim();
      localStorage.setItem(KEY.USER, JSON.stringify(userData));
      modal.style.display = 'none';
      updateProfileUI();
    });

    document.getElementById('closeModalBtn')?.addEventListener('click', () => {
      modal.style.display = 'none';
    });

    // –û—á–∏—Å—Ç–∫–∞
    document.getElementById('clearAllData')?.addEventListener('click', () => {
      if (confirm('–í–∏–¥–∞–ª–∏—Ç–∏ –≤—Å—ñ –¥–∞–Ω—ñ?')) {
        localStorage.clear();
        location.reload();
      }
    });

    // –û—Ç—Ä–∏–º–∞—Ç–∏ –∞–≤–∞—Ç–∞—Ä
    function getAvatar(uname) {
      return (uname === username && userData.avatar) ? userData.avatar : '';
    }

    // –†–µ–Ω–¥–µ—Ä –ø–æ—Å—Ç—ñ–≤
    function renderPosts(container = feed, onlyUser = false) {
      if (!container) return;
      container.innerHTML = '';
      const filtered = posts.filter(p => !onlyUser || p.username === username);
      filtered.forEach(post => {
        const isLiked = post.likedBy?.includes(username);
        const isFavorite = userData.favorites?.includes(post.id);

        const postEl = document.createElement('div');
        postEl.className = 'post';
        postEl.innerHTML = `
          <div class="post-header">
            <div class="avatar" style="background-image:url('${getAvatar(post.username)}')"></div>
            <div>
              <div class="post-author">${post.username}</div>
              <div class="post-meta">${new Date(post.created).toLocaleString('uk-UA', { dateStyle: 'short', timeStyle: 'short' })}</div>
            </div>
          </div>
          <div class="post-content" id="content-${post.id}">${post.text.replace(/\n/g, '<br>')}</div>
          <div class="post-footer">
            <button class="like-btn ${isLiked ? 'liked' : ''}">‚ù§Ô∏è ${post.likes || 0}</button>
            <button class="comment-btn">üí¨ ${post.comments?.length || 0}</button>
            <button class="favorite-btn ${isFavorite ? 'favorited' : ''}">‚≠ê</button>
            ${post.username === username ? '<button class="edit-btn">‚úèÔ∏è –†–µ–¥–∞–≥—É–≤–∞—Ç–∏</button>' : ''}
          </div>
          <div class="comments-section" id="comments-${post.id}"></div>
          <div class="comment-input">
            <div class="comment-avatar" style="background-image:url('${getAvatar(username)}')"></div>
            <input type="text" placeholder="–ù–∞–ø–∏—à—ñ—Ç—å –∫–æ–º–µ–Ω—Ç–∞—Ä..." class="comment-inp" />
            <button class="add-comment-btn">–í—ñ–¥–ø—Ä–∞–≤–∏—Ç–∏</button>
          </div>
        `;

        // –õ–∞–π–∫
        postEl.querySelector('.like-btn')?.addEventListener('click', () => {
          if (!username) return alert('–£–≤—ñ–π–¥—ñ—Ç—å');
          if (!post.likedBy) post.likedBy = [];
          const idx = post.likedBy.indexOf(username);
          idx === -1 ? (post.likedBy.push(username), post.likes++) : (post.likedBy.splice(idx,1), post.likes--);
          localStorage.setItem(KEY.POSTS, JSON.stringify(posts));
          renderPosts(container, onlyUser);
          if (container !== feed) updateProfileUI();
        });

        // –§–∞–≤–æ—Ä–∏—Ç
        postEl.querySelector('.favorite-btn')?.addEventListener('click', () => {
          if (!username) return alert('–£–≤—ñ–π–¥—ñ—Ç—å');
          if (!userData.favorites) userData.favorites = [];
          const idx = userData.favorites.indexOf(post.id);
          idx === -1 ? userData.favorites.push(post.id) : userData.favorites.splice(idx,1);
          localStorage.setItem(KEY.USER, JSON.stringify(userData));
          renderPosts(container, onlyUser);
        });

        // –ö–æ–º–µ–Ω—Ç–∞—Ä
        const inp = postEl.querySelector('.comment-inp');
        const addBtn = postEl.querySelector('.add-comment-btn');
        addBtn.addEventListener('click', () => {
          const text = inp.value.trim();
          if (!text || !username) return;
          if (!post.comments) post.comments = [];
          post.comments.push({ user: username, text, time: Date.now() });
          inp.value = '';
          localStorage.setItem(KEY.POSTS, JSON.stringify(posts));
          renderComments(post.id, postEl.querySelector(`#comments-${post.id}`));
        });

        // –†–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è
        if (post.username === username) {
          postEl.querySelector('.edit-btn')?.addEventListener('click', () => {
            const contentDiv = document.getElementById(`content-${post.id}`);
            const textarea = document.createElement('textarea');
            textarea.value = post.text;
            textarea.style.width = '100%';
            textarea.style.margin = '10px 0';
            const saveBtn = document.createElement('button');
            saveBtn.textContent = '–ó–±–µ—Ä–µ–≥—Ç–∏';
            saveBtn.style.background = 'var(--accent)';
            saveBtn.style.color = 'white';
            saveBtn.style.border = 'none';
            saveBtn.style.borderRadius = 'var(--radius-full)';
            saveBtn.style.padding = '8px 20px';
            contentDiv.replaceWith(textarea);
            textarea.after(saveBtn);
            saveBtn.addEventListener('click', () => {
              post.text = textarea.value.trim();
              localStorage.setItem(KEY.POSTS, JSON.stringify(posts));
              renderPosts(container, onlyUser);
            });
          });
        }

        renderComments(post.id, postEl.querySelector(`#comments-${post.id}`));
        container.appendChild(postEl);
      });
    }

    function renderComments(postId, container) {
      if (!container) return;
      container.innerHTML = '';
      const post = posts.find(p => p.id === postId);
      (post?.comments || []).forEach(c => {
        const div = document.createElement('div');
        div.className = 'comment';
        div.innerHTML = `
          <div class="comment-avatar" style="background-image:url('${getAvatar(c.user)}')"></div>
          <div class="comment-content">
            <span class="comment-author">${c.user}</span>
            <span>${c.text}</span>
          </div>
        `;
        container.appendChild(div);
      });
    }

    function updateProfileUI() {
      if (!username) return;
      document.getElementById('profileUsernameDisplay').textContent = username;
      document.getElementById('registerDate').textContent = userData.registered || '–Ω–µ–≤—ñ–¥–æ–º–æ';
      document.getElementById('profileBio').textContent = userData.bio || '–û–ø–∏—Å –≤—ñ–¥—Å—É—Ç–Ω—ñ–π';
      document.getElementById('profileAvatar').style.backgroundImage = userData.avatar ? `url('${userData.avatar}')` : '';
      
      let pCount = 0, lCount = 0;
      posts.forEach(p => { if (p.username === username) { pCount++; lCount += p.likes || 0; } });
      document.getElementById('postCount').textContent = pCount;
      document.getElementById('likeCount').textContent = lCount;
      document.getElementById('favoriteCount').textContent = userData.favorites?.length || 0;
      
      renderPosts(document.getElementById('profilePosts'), true);
      updateAvatars();
    }

    // –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è
    if (username) {
      renderPosts();
      updateProfileUI();
      updateAvatars();
    }
  })();
</script>

</body>
</html>
