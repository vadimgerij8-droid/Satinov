<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>FANTASYAS</title>
  <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
  <style>
    :root {
      --bg: #0a0a0a;
      --text: #f0f0f0;
      --text-sec: #a0a0a0;
      --card: rgba(26, 26, 26, 0.45);
      --border: rgba(80, 80, 80, 0.6);
      --shadow: 0 8px 32px rgba(0, 0, 0, 0.6);
      --blur: blur(12px);
      --glass-border: 1px solid rgba(255, 255, 255, 0.08);
    }
    body.light {
      --bg: #f8f8f8;
      --text: #1a1a1a;
      --text-sec: #666;
      --card: rgba(255, 255, 255, 0.55);
      --border: rgba(200, 200, 200, 0.6);
      --shadow: 0 8px 32px rgba(0, 0, 0, 0.12);
      --blur: blur(16px);
      --glass-border: 1px solid rgba(0, 0, 0, 0.08);
    }
    * { margin:0; padding:0; box-sizing:border-box; }
    body {
      font-family:'Manrope',sans-serif;
      background: var(--bg);
      color: var(--text);
      min-height:100vh;
      transition: all 0.5s ease;
    }
    body.tv-mode {
      font-size: 1.4rem;
      --card: rgba(34,34,34,0.85);
    }
    body.tv-mode .main-content { max-width: 1200px; padding: 40px; }
    body.tv-mode .card, body.tv-mode .post { padding: 35px; font-size: 1.3rem; border-radius: 28px; }
    body.tv-mode input, body.tv-mode textarea, body.tv-mode button { padding: 18px; font-size: 1.3rem; }

    @keyframes fadeIn { 0%{opacity:0} 100%{opacity:1} }
    @keyframes slideInLeft { 0%{opacity:0;transform:translateX(-50px)} 100%{opacity:1;transform:translateX(0)} }
    @keyframes bounceIn { 0%{transform:scale(0.8);opacity:0} 50%{transform:scale(1.1)} 100%{transform:scale(1);opacity:1} }
    @keyframes pulse { 0%,100%{transform:scale(1)} 50%{transform:scale(1.05)} }
    .fade-in { animation:fadeIn 0.8s ease-in-out; }
    .slide-in { animation:slideInLeft 0.6s ease-out; }
    .bounce { animation:bounceIn 0.7s ease; }
    .pulse { animation:pulse 1.5s infinite; }

    .top-bar {
      position: fixed;
      top: 0; left: 0; right: 0;
      height: 60px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 20px;
      background: rgba(10,10,10,0.4);
      backdrop-filter: var(--blur);
      border-bottom: var(--glass-border);
      z-index: 1000;
      box-shadow: var(--shadow);
    }
    body.light .top-bar { background: rgba(255,255,255,0.4); }

    .site-name { font-size: 1.8rem; font-weight: 800; color: var(--text); }
    .burger { cursor: pointer; width: 30px; height: 22px; display: flex; flex-direction: column; justify-content: space-between; }
    .burger span { height: 3px; background: var(--text); transition: all 0.4s; border-radius: 2px; }
    .burger.active span:nth-child(1) { transform: rotate(45deg) translate(6px,6px); }
    .burger.active span:nth-child(2) { opacity: 0; }
    .burger.active span:nth-child(3) { transform: rotate(-45deg) translate(7px,-7px); }

    .sidebar {
      position: fixed;
      top: 0; left: -300px;
      width: 300px; height: 100%;
      background: var(--card);
      backdrop-filter: var(--blur);
      border-right: var(--glass-border);
      padding: 80px 25px;
      transition: left 0.6s cubic-bezier(0.68,-0.55,0.265,1.55);
      z-index: 900;
      box-shadow: var(--shadow);
    }
    .sidebar.active { left: 0; }
    .sidebar a {
      display: flex;
      align-items: center;
      gap: 15px;
      color: var(--text-sec);
      text-decoration: none;
      font-size: 1.2rem;
      font-weight: 600;
      margin: 15px 0;
      padding: 10px 15px;
      border-radius: 12px;
      transition: all 0.3s ease;
    }
    .sidebar a:hover { background: rgba(255,255,255,0.12); color: var(--text); transform: translateX(10px); }

    .main-content { margin-top: 70px; padding: 25px; max-width: 900px; margin: 0 auto; }
    .section { display: none; }
    .section.active { display: block; animation: fadeIn 0.8s ease; }

    .card {
      background: var(--card);
      backdrop-filter: var(--blur);
      border: var(--glass-border);
      border-radius: 20px;
      padding: 25px;
      margin-bottom: 25px;
      box-shadow: var(--shadow);
      transition: all 0.4s ease;
    }
    .card:hover { transform: translateY(-6px); box-shadow: 0 16px 40px rgba(0,0,0,0.4); }

    input, textarea {
      width: 100%;
      padding: 15px;
      margin: 10px 0;
      border: var(--glass-border);
      border-radius: 15px;
      background: rgba(255,255,255,0.05);
      color: var(--text);
      font-size: 1rem;
      transition: all 0.3s ease;
      backdrop-filter: var(--blur);
    }
    input:focus, textarea:focus {
      border-color: rgba(255,255,255,0.3);
      box-shadow: 0 0 15px rgba(255,255,255,0.08);
      outline: none;
    }

    button {
      padding: 12px 25px;
      border: none;
      border-radius: 15px;
      background: rgba(255,255,255,0.08);
      color: var(--text);
      font-weight: 700;
      cursor: pointer;
      transition: all 0.4s ease;
      backdrop-filter: var(--blur);
    }
    button:hover {
      background: rgba(255,255,255,0.18);
      transform: scale(1.04);
      box-shadow: 0 0 20px rgba(255,255,255,0.1);
    }

    .feed { display: flex; flex-direction: column; gap: 25px; }
    .post {
      background: var(--card);
      backdrop-filter: var(--blur);
      border: var(--glass-border);
      border-radius: 20px;
      padding: 20px;
      box-shadow: var(--shadow);
      animation: slideInLeft 0.6s ease-out;
    }
    .post:hover { transform: scale(1.02); box-shadow: 0 15px 40px rgba(255,255,255,0.1); }

    .avatar { width: 50px; height: 50px; border-radius: 50%; background: #444; background-size: cover; border: 2px solid var(--border); transition: transform 0.3s ease; }
    .avatar:hover { transform: rotate(360deg); }

    .profile-header {
      text-align: center;
      padding: 50px 20px 40px;
      background: var(--card);
      backdrop-filter: var(--blur);
      border-radius: 0 0 30px 30px;
      margin-bottom: 20px;
      border-bottom: var(--glass-border);
    }
    .profile-avatar-wrapper { position: relative; width: 140px; height: 140px; margin: 0 auto 25px; }
    .profile-avatar-large { width: 100%; height: 100%; border-radius: 50%; background-size: cover; border: 5px solid var(--border); box-shadow: var(--shadow); transition: transform 0.3s ease; }
    .profile-avatar-large:hover { transform: scale(1.06); }
    .avatar-edit-btn {
      position: absolute;
      bottom: 8px; right: 8px;
      background: rgba(255,255,255,0.12);
      color: var(--text);
      width: 48px; height: 48px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      border: 2px solid rgba(255,255,255,0.2);
      backdrop-filter: var(--blur);
      transition: all 0.3s;
    }
    .avatar-edit-btn:hover { background: rgba(255,255,255,0.25); transform: scale(1.15); }

    .chat-list { display: flex; flex-direction: column; gap: 12px; }
    .chat-item {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 12px;
      border-radius: 16px;
      background: var(--card);
      backdrop-filter: var(--blur);
      border: var(--glass-border);
      cursor: pointer;
      transition: all 0.3s;
    }
    .chat-item:hover { background: rgba(255,255,255,0.08); transform: translateX(6px); }
    .chat-header {
      padding: 12px;
      background: var(--card);
      backdrop-filter: var(--blur);
      border-bottom: var(--glass-border);
      position: sticky;
      top: 0;
      z-index: 10;
    }
    .messages {
      flex: 1;
      overflow-y: auto;
      padding: 16px;
      display: flex;
      flex-direction: column;
      gap: 10px;
      min-height: 50vh;
    }
    .message {
      max-width: 80%;
      padding: 10px 14px;
      border-radius: 20px;
      line-height: 1.4;
      backdrop-filter: var(--blur);
    }
    .message.sent {
      align-self: flex-end;
      background: rgba(255,255,255,0.12);
      border: 1px solid rgba(255,255,255,0.18);
    }
    .message.received {
      align-self: flex-start;
      background: var(--card);
      border: var(--glass-border);
    }
    .chat-input-area {
      display: flex;
      padding: 12px;
      gap: 8px;
      background: var(--card);
      backdrop-filter: var(--blur);
      border-top: var(--glass-border);
      position: sticky;
      bottom: 0;
    }
    .chat-input-area input {
      border-radius: 50px;
      background: rgba(255,255,255,0.05);
      border: var(--glass-border);
    }
  </style>
</head>
<body>
  <div class="top-bar">
    <div class="burger" id="burger"><span></span><span></span><span></span></div>
    <div class="site-name">FANTASYAS</div>
  </div>

  <nav class="sidebar" id="sidebar">
    <a data-section="home"><i class="fas fa-home"></i> Головна</a>
    <a data-section="profile"><i class="fas fa-user"></i> Профіль</a>
    <a data-section="chat"><i class="fas fa-comments"></i> Чати</a>
    <a data-section="settings"><i class="fas fa-cog"></i> Налаштування</a>
  </nav>

  <main class="main-content">
    <section id="home" class="section active">
      <div class="card" id="auth-card">
        <div id="login-form">
          <h2 class="fade-in">Вхід</h2>
          <input id="login-nick" placeholder="Псевдонім">
          <input id="login-pass" type="password" placeholder="Пароль">
          <button id="login-btn" class="bounce">Увійти</button>
          <p class="fade-in">Немає акаунта? <span id="to-reg" class="pulse" style="color:#ccc;cursor:pointer;">Зареєструватись</span></p>
        </div>
        <div id="reg-form" style="display:none;">
          <h2 class="fade-in">Реєстрація</h2>
          <input id="reg-nick" placeholder="Псевдонім">
          <input id="reg-pass" type="password" placeholder="Пароль">
          <button id="reg-btn" class="bounce">Зареєструватись</button>
          <p class="fade-in">Є акаунт? <span id="to-login" class="pulse" style="color:#ccc;cursor:pointer;">Увійти</span></p>
        </div>
      </div>

      <div class="card" id="post-form" style="display:none;">
        <textarea id="post-text" placeholder="Що нового?..." rows="3"></textarea>
        <button id="submit-post">Опублікувати</button>
      </div>

      <div class="feed" id="feed"></div>
    </section>

    <section id="profile" class="section">
      <div class="profile-header">
        <div class="profile-avatar-wrapper">
          <div class="profile-avatar-large" id="profile-avatar-large"></div>
          <label for="avatar-upload" class="avatar-edit-btn"><i class="fas fa-camera"></i></label>
          <input type="file" id="avatar-upload" accept="image/*" style="display:none;">
        </div>
        <h1 id="profile-nick-large">@...</h1>
        <p id="profile-bio-large">Тут короткий опис про себе</p>
        <button id="edit-profile-btn" class="bounce">Редагувати профіль</button>
      </div>

      <div id="edit-profile-form" class="card" style="display:none; max-width:500px; margin:0 auto;">
        <h2>Редагувати профіль</h2>
        <input id="set-nick" placeholder="Новий псевдонім">
        <input id="set-pass" type="password" placeholder="Новий пароль (опціонально)">
        <textarea id="set-bio" placeholder="Опис про себе" rows="3"></textarea>
        <button id="save-profile">Зберегти</button>
        <button id="cancel-edit">Скасувати</button>
      </div>

      <div class="feed" id="profile-posts"></div>
    </section>

    <section id="chat" class="section">
      <div id="chat-list-view" class="card fade-in">
        <h2>Чати</h2>
        <div class="chat-search">
          <input id="chat-search-input" placeholder="Пошук чатів...">
        </div>
        <div id="chat-list" class="chat-list"></div>
      </div>

      <div id="chat-window" style="display:none;">
        <div class="chat-header">
          <button id="back-to-list">←</button>
          <div class="chat-partner">
            <div class="avatar" id="chat-avatar"></div>
            <strong id="chat-nick"></strong>
          </div>
        </div>
        <div id="messages" class="messages"></div>
        <div class="chat-input-area">
          <input id="message-input" placeholder="Напишіть повідомлення...">
          <button id="send-message">➤</button>
        </div>
      </div>
    </section>

    <section id="settings" class="section">
      <div class="card fade-in">
        <h2>Налаштування</h2>
        <div style="margin:20px 0;">
          <h3>Акаунт</h3>
          <input id="set-nick" placeholder="Змінити псевдонім">
          <input id="set-pass" type="password" placeholder="Змінити пароль">
          <input id="set-bio" placeholder="Коротко про себе">
          <button id="save-account">Зберегти акаунт</button>
        </div>
        <div style="margin:30px 0;">
          <h3>Режим екрану</h3>
          <div style="display:flex; gap:20px; margin-top:12px;">
            <button id="mode-phone" style="flex:1; padding:16px;">
              <i class="fas fa-mobile-alt" style="font-size:2rem; margin-bottom:8px;"></i><br>Телефон
            </button>
            <button id="mode-tv" style="flex:1; padding:16px;">
              <i class="fas fa-tv" style="font-size:2rem; margin-bottom:8px;"></i><br>Телевізор
            </button>
          </div>
        </div>
        <div style="margin-top:30px;">
          <h3>Тема</h3>
          <button id="toggle-theme" style="width:100%; margin-top:12px;">Світла / Темна</button>
        </div>
      </div>
    </section>
  </main>

  <script>
    let db, currentUser = localStorage.getItem('user');

    const request = indexedDB.open('FantasyasDB', 3);
    request.onupgradeneeded = e => {
      db = e.target.result;
      db.createObjectStore('users', {keyPath: 'nick'});
      db.createObjectStore('posts', {autoIncrement: true});
      db.createObjectStore('messages', {autoIncrement: true});
    };
    request.onsuccess = e => { db = e.target.result; initApp(); };

    function initApp() {
      const burger = document.getElementById('burger');
      const sidebar = document.getElementById('sidebar');
      burger.onclick = () => {
        burger.classList.toggle('active');
        sidebar.classList.toggle('active');
      };

      document.querySelectorAll('.sidebar a').forEach(a => {
        a.onclick = () => {
          document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
          document.getElementById(a.dataset.section).classList.add('active');
          sidebar.classList.remove('active');
          burger.classList.remove('active');
          if (a.dataset.section === 'profile') loadProfile();
        };
      });

      document.getElementById('to-reg').onclick = () => {
        document.getElementById('login-form').style.display = 'none';
        document.getElementById('reg-form').style.display = 'block';
      };
      document.getElementById('to-login').onclick = () => {
        document.getElementById('reg-form').style.display = 'none';
        document.getElementById('login-form').style.display = 'block';
      };

      document.getElementById('reg-btn').onclick = () => {
        const nick = document.getElementById('reg-nick').value.trim();
        const pass = document.getElementById('reg-pass').value.trim();
        if (!nick || !pass) return alert('Заповніть поля');
        db.transaction('users', 'readwrite').objectStore('users').add({nick, pass, bio:'', avatar:''});
        alert('Реєстрація успішна! Увійдіть.');
        document.getElementById('to-login').click();
      };

      document.getElementById('login-btn').onclick = () => {
        const nick = document.getElementById('login-nick').value.trim();
        const pass = document.getElementById('login-pass').value.trim();
        db.transaction('users').objectStore('users').get(nick).onsuccess = e => {
          const user = e.target.result;
          if (user && user.pass === pass) {
            currentUser = nick;
            localStorage.setItem('user', nick);
            document.getElementById('auth-card').style.display = 'none';
            document.getElementById('post-form').style.display = 'block';
            loadPosts();
          } else alert('Невірні дані');
        };
      };

      document.getElementById('submit-post').onclick = () => {
        const text = document.getElementById('post-text').value.trim();
        if (!text) return alert('Напишіть пост');
        db.transaction('posts', 'readwrite').objectStore('posts').add({author: currentUser, text, created: Date.now()});
        document.getElementById('post-text').value = '';
        loadPosts();
      };

      function loadPosts() {
        const feed = document.getElementById('feed');
        feed.innerHTML = '';
        db.transaction('posts').objectStore('posts').openCursor(null, 'prev').onsuccess = e => {
          const cursor = e.target.result;
          if (cursor) {
            const post = cursor.value;
            const div = document.createElement('div');
            div.className = 'post';
            div.innerHTML = `<strong>@${post.author}</strong><p>${post.text}</p>`;
            feed.appendChild(div);
            cursor.continue();
          }
        };
      }

      function loadProfile() {
        if (!currentUser) return;
        db.transaction('users').objectStore('users').get(currentUser).onsuccess = e => {
          const u = e.target.result;
          document.getElementById('profile-nick-large').textContent = '@' + u.nick;
          document.getElementById('profile-bio-large').textContent = u.bio || 'Тут короткий опис про себе';
          if (u.avatar) document.getElementById('profile-avatar-large').style.backgroundImage = `url(${u.avatar})`;
        };
      }

      document.getElementById('avatar-upload').onchange = e => {
        const file = e.target.files[0];
        if (!file) return;
        const reader = new FileReader();
        reader.onload = ev => {
          document.getElementById('profile-avatar-large').style.backgroundImage = `url(${ev.target.result})`;
          localStorage.setItem('tempAv', ev.target.result);
        };
        reader.readAsDataURL(file);
      };

      document.getElementById('save-profile').onclick = () => {
        const bio = document.getElementById('set-bio').value.trim();
        const av = localStorage.getItem('tempAv');
        db.transaction('users', 'readwrite').objectStore('users').get(currentUser).onsuccess = e => {
          const u = e.target.result;
          u.bio = bio;
          if (av) u.avatar = av;
          db.transaction('users', 'readwrite').objectStore('users').put(u);
          alert('Збережено');
          localStorage.removeItem('tempAv');
          loadProfile();
        };
      };

      document.getElementById('toggle-theme').onclick = () => document.body.classList.toggle('light');

      document.getElementById('mode-phone').onclick = () => {
        document.body.classList.remove('tv-mode');
        localStorage.setItem('viewMode', 'phone');
      };

      document.getElementById('mode-tv').onclick = () => {
        document.body.classList.add('tv-mode');
        localStorage.setItem('viewMode', 'tv');
      };

      if (localStorage.getItem('viewMode') === 'tv') document.body.classList.add('tv-mode');

      if (currentUser) {
        document.getElementById('auth-card').style.display = 'none';
        document.getElementById('post-form').style.display = 'block';
        loadPosts();
      }
    }
  </script>
</body>
</html>
