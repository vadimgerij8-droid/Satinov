<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>FANTASYAS</title>
  <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@400;500;600;700;800&display=swap" rel="stylesheet"/>
  
  <style>
    :root {
      --bg: #000;
      --text: #ffffff;
      --text-sec: #cccccc;
      --card-bg: rgba(255,255,255,0.06);
      --card-border: rgba(255,255,255,0.12);
      --input-bg: rgba(255,255,255,0.08);
      --input-border: rgba(255,255,255,0.18);
      --btn-bg: #555;
      --accent: #0af;
      --like: #ff3366;
    }

    body.light {
      --bg: #ffffff;
      --text: #111111;
      --text-sec: #555555;
      --card-bg: rgba(0,0,0,0.04);
      --card-border: rgba(0,0,0,0.10);
      --input-bg: #ffffff;
      --input-border: #d0d0d0;
      --btn-bg: #444444;
      --accent: #0066cc;
      --like: #e63946;
    }

    * { margin:0; padding:0; box-sizing:border-box; font-family:'Manrope',sans-serif; }
    body {
      background:var(--bg);
      color:var(--text);
      min-height:100vh;
      transition: background 0.5s, color 0.5s;
    }

    .top-bar {
      position:fixed; top:0; left:0; right:0; height:70px;
      display:flex; align-items:center; justify-content:space-between;
      padding:0 20px; background:rgba(0,0,0,0.6); backdrop-filter:blur(8px);
      z-index:1000; transition:background 0.4s;
    }
    body.light .top-bar { background:rgba(255,255,255,0.92); }

    .site-name {
      font-size:1.8rem; font-weight:800;
      background:linear-gradient(90deg, #ffffff, #bbbbbb);
      -webkit-background-clip:text; background-clip:text;
      color:transparent; -webkit-text-fill-color:transparent;
    }
    body.light .site-name {
      background:linear-gradient(90deg, #111111, #444444);
      -webkit-background-clip:text; background-clip:text;
      color:transparent; -webkit-text-fill-color:transparent;
    }

    .burger { width:32px; height:24px; cursor:pointer; }
    .burger span {
      display:block; height:3px; background:var(--text);
      border-radius:2px; transition:all 0.35s;
    }
    .burger.active span:nth-child(1){transform:rotate(45deg) translate(7px,7px);}
    .burger.active span:nth-child(2){opacity:0;}
    .burger.active span:nth-child(3){transform:rotate(-45deg) translate(6px,-6px);}

    .sidebar {
      position:fixed; top:0; left:-300px; width:280px; height:100%;
      background:rgba(0,0,0,0.5); backdrop-filter:blur(12px);
      padding:90px 28px; transition:left 0.4s ease;
      z-index:900; border-right:1px solid var(--card-border);
    }
    body.light .sidebar { background:rgba(255,255,255,0.5); }
    .sidebar.active { left:0; }

    .sidebar a {
      display:block; color:var(--text-sec); text-decoration:none;
      font-size:1.22rem; font-weight:600; margin:1.4rem 0;
      transition:all 0.25s;
    }
    .sidebar a:hover { color:var(--text); transform:translateX(8px); }

    .main-content { margin-top:90px; padding:20px; max-width:720px; margin-inline:auto; }

    .section { display:none; opacity:0; transform:translateY(12px); transition:opacity 0.35s, transform 0.35s; }
    .section.active { display:block; opacity:1; transform:translateY(0); }

    .card {
      background:var(--card-bg);
      border:1px solid var(--card-border);
      border-radius:14px;
      padding:20px;
      margin-bottom:20px;
    }

    input, textarea {
      width:100%; padding:12px 14px; border-radius:10px;
      border:1px solid var(--input-border); background:var(--input-bg);
      color:var(--text); font-size:1rem; outline:none; transition:border-color 0.2s;
    }
    input:focus, textarea:focus { border-color:var(--accent); }
    textarea { resize:vertical; min-height:96px; }
    ::placeholder { color:var(--text-sec); opacity:0.7; }

    button {
      padding:11px 20px; border:none; border-radius:10px;
      background:var(--btn-bg); color:white; font-weight:700;
      cursor:pointer; transition:all 0.22s;
    }
    button:hover { opacity:0.92; transform:scale(1.03); }

    .feed { display:flex; flex-direction:column; gap:20px; }

    .post {
      background:var(--card-bg);
      border:1px solid var(--card-border);
      border-radius:16px;
      padding:18px;
      opacity:0; transform:translateY(30px) scale(0.97);
      transition:all 0.6s cubic-bezier(0.34, 1.56, 0.64, 1);
    }
    .post.visible { opacity:1; transform:translateY(0) scale(1); }

    .post-header { display:flex; align-items:center; gap:12px; margin-bottom:12px; }
    .avatar {
      width:48px; height:48px; border-radius:50%;
      background:#555; background-size:cover; background-position:center;
      border:1px solid var(--card-border); flex-shrink:0;
    }
    body.light .avatar { background:#ccc; }

    .username { font-weight:700; font-size:1.05rem; }

    .post-content { line-height:1.55; font-size:1.02rem; margin-bottom:14px; word-break:break-word; }

    .post-footer {
      display:flex; justify-content:space-between; align-items:center;
      margin-top:10px; color:var(--text-sec);
    }

    .actions { display:flex; gap:28px; }
    .action-btn {
      background:none; border:none; color:var(--text-sec);
      font-size:0.98rem; cursor:pointer; display:flex; align-items:center; gap:6px;
      transition:all 0.25s;
    }
    .action-btn:hover { color:var(--text); transform:scale(1.08); }
    .action-btn.liked { color:var(--like); animation:heartPop 0.45s ease; }

    @keyframes heartPop {
      0%   { transform:scale(1); }
      40%  { transform:scale(1.45); }
      70%  { transform:scale(0.92); }
      100% { transform:scale(1); }
    }

    .reactions { position:relative; }
    .emoji-picker {
      position:absolute; bottom:100%; left:-10px;
      background:var(--card-bg); border:1px solid var(--card-border);
      border-radius:12px; padding:8px 10px; display:none;
      flex-wrap:wrap; gap:8px; backdrop-filter:blur(8px);
      z-index:10; min-width:220px; box-shadow:0 8px 24px rgba(0,0,0,0.45);
      transform:scale(0.7); opacity:0; transition:all 0.22s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    }
    .emoji-picker.active { display:flex; transform:scale(1); opacity:1; }
    .emoji {
      font-size:1.7rem; cursor:pointer; padding:6px;
      border-radius:8px; transition:transform 0.18s;
    }
    .emoji:hover { transform:scale(1.35); background:rgba(255,255,255,0.12); }

    .modal { position:fixed; inset:0; background:rgba(0,0,0,0.75); display:none; align-items:center; justify-content:center; z-index:2000; }
    body.light .modal { background:rgba(0,0,0,0.6); }
    .modal.active { display:flex; }
    .modal-content {
      background:var(--card-bg); border:1px solid var(--card-border);
      border-radius:16px; width:92%; max-width:500px; padding:28px; color:var(--text);
    }

    @media (max-width:900px) {
      .sidebar { width:100%; left:-100%; border-right:none; }
      .main-content { padding:16px; margin-top:80px; }
    }
  </style>
</head>
<body>

<div class="top-bar">
  <div class="burger" id="burger"><span></span><span></span><span></span></div>
  <div class="site-name">FANTASYAS</div>
</div>

<nav class="sidebar" id="sidebar">
  <a data-section="home">–ì–æ–ª–æ–≤–Ω–∞</a>
  <a data-section="profile">–ü—Ä–æ—Ñ—ñ–ª—å</a>
  <a data-section="messages">–ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è</a>
  <a data-section="groups">–ì—Ä—É–ø–∏</a>
  <a data-section="settings">–ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è</a>
</nav>

<main class="main-content">

  <div id="home" class="section active">
    <div class="card" id="authBox">
      <div id="loginForm">
        <input type="text" id="loginNickname" placeholder="–ü—Å–µ–≤–¥–æ–Ω—ñ–º" autocomplete="off"/>
        <input type="password" id="loginPassword" placeholder="–ü–∞—Ä–æ–ª—å"/>
        <button id="loginBtn">–£–≤—ñ–π—Ç–∏</button>
        <p style="margin-top:12px;">–ù–µ–º–∞—î –∞–∫–∞—É–Ω—Ç–∞? <span id="toRegister" style="color:var(--accent);cursor:pointer;">–ó–∞—Ä–µ—î—Å—Ç—Ä—É–≤–∞—Ç–∏—Å—è</span></p>
      </div>

      <div id="registerForm" style="display:none;">
        <input type="text" id="registerNickname" placeholder="–ü—Å–µ–≤–¥–æ–Ω—ñ–º" autocomplete="off"/>
        <input type="password" id="registerPassword" placeholder="–ü–∞—Ä–æ–ª—å"/>
        <button id="registerBtn">–ó–∞—Ä–µ—î—Å—Ç—Ä—É–≤–∞—Ç–∏—Å—è</button>
        <p style="margin-top:12px;">–í–∂–µ —î –∞–∫–∞—É–Ω—Ç? <span id="toLogin" style="color:var(--accent);cursor:pointer;">–£–≤—ñ–π—Ç–∏</span></p>
      </div>
    </div>

    <div class="card" id="newPostBox" style="display:none;">
      <textarea id="postText" placeholder="–©–æ —É —Ç–µ–±–µ –Ω–∞ –¥—É–º—Ü—ñ?..."></textarea>
      <button id="addPost" style="margin-top:12px; float:right;">–û–ø—É–±–ª—ñ–∫—É–≤–∞—Ç–∏</button>
    </div>

    <div class="feed" id="feed"></div>
  </div>

  <div id="profile" class="section">
    <div class="card profile-header">
      <div class="profile-avatar" id="profileAvatar"></div>
      <input type="file" id="avatarInput" accept="image/*" style="display:none;"/>
      <div style="flex:1;">
        <h2 id="profileUsernameDisplay"></h2>
        <p id="profileBio" style="margin:8px 0;color:var(--text-sec);">–ù–µ–º–∞—î –æ–ø–∏—Å—É</p>
        <div style="display:flex;gap:20px;font-weight:600;color:var(--text-sec);">
          <span id="postsCount">–ü–æ—Å—Ç–∏: 0</span>
          <span id="followersCount">–ü—ñ–¥–ø–∏—Å–Ω–∏–∫–∏: 0</span>
          <span id="followingCount">–ü—ñ–¥–ø–∏—Å–∫–∏: 0</span>
        </div>
      </div>
      <button id="editProfileBtn">–†–µ–¥–∞–≥—É–≤–∞—Ç–∏ –ø—Ä–æ—Ñ—ñ–ª—å</button>
    </div>
  </div>

  <div id="settings" class="section card">
    <h2>–ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è</h2>
    <button id="toggleTheme" style="margin-top:16px;">–ü–µ—Ä–µ–º–∫–Ω—É—Ç–∏ —Ç–µ–º—É</button>
  </div>

</main>

<div class="modal" id="editProfileModal">
  <div class="modal-content">
    <span class="close-modal" id="closeModal">√ó</span>
    <h2>–†–µ–¥–∞–≥—É–≤–∞—Ç–∏ –ø—Ä–æ—Ñ—ñ–ª—å</h2>
    <textarea id="editBio" placeholder="–†–æ–∑–∫–∞–∂–∏ –ø—Ä–æ —Å–µ–±–µ..." rows="5"></textarea>
    <button id="saveProfileEdit" style="margin-top:16px;">–ó–±–µ—Ä–µ–≥—Ç–∏</button>
  </div>
</div>

<div class="modal" id="commentsModal">
  <div class="modal-content">
    <h3>–ö–æ–º–µ–Ω—Ç–∞—Ä—ñ</h3>
    <p style="color:var(--text-sec); text-align:center; margin:60px 0;">–§—É–Ω–∫—Ü—ñ—è –∫–æ–º–µ–Ω—Ç–∞—Ä—ñ–≤ —É —Ä–æ–∑—Ä–æ–±—Ü—ñ...</p>
    <button onclick="document.getElementById('commentsModal').classList.remove('active')">–ó–∞–∫—Ä–∏—Ç–∏</button>
  </div>
</div>

<script>
// –ë—É—Ä–≥–µ—Ä –º–µ–Ω—é + –Ω–∞–≤—ñ–≥–∞—Ü—ñ—è
const burger = document.getElementById('burger');
const sidebar = document.getElementById('sidebar');
burger.onclick = () => {
  burger.classList.toggle('active');
  sidebar.classList.toggle('active');
};

document.querySelectorAll('[data-section]').forEach(link => {
  link.onclick = () => {
    document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
    document.getElementById(link.dataset.section)?.classList.add('active');
    sidebar.classList.remove('active');
    burger.classList.remove('active');
  };
});

// –î–∞–Ω—ñ
let users = JSON.parse(localStorage.getItem('users')) || {};
let currentUser = localStorage.getItem('currentUser') || null;

const authBox = document.getElementById('authBox');
const newPostBox = document.getElementById('newPostBox');
const feed = document.getElementById('feed');

// –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—è / –†–µ—î—Å—Ç—Ä–∞—Ü—ñ—è (–∑ —Ç–≤–æ–≥–æ –∫–æ–¥—É)
document.getElementById('toRegister').onclick = () => { document.getElementById('loginForm').style.display = 'none'; document.getElementById('registerForm').style.display = 'block'; };
document.getElementById('toLogin').onclick = () => { document.getElementById('registerForm').style.display = 'none'; document.getElementById('loginForm').style.display = 'block'; };

document.getElementById('registerBtn').onclick = () => {
  const nick = document.getElementById('registerNickname').value.trim();
  const pass = document.getElementById('registerPassword').value.trim();
  if (!nick || !pass) return alert('–ó–∞–ø–æ–≤–Ω—ñ—Ç—å —É—Å—ñ –ø–æ–ª—è');
  if (users[nick]) return alert('–¢–∞–∫–∏–π –ø—Å–µ–≤–¥–æ–Ω—ñ–º –≤–∂–µ –∑–∞–π–Ω—è—Ç–∏–π');
  users[nick] = { password: pass, bio: '', avatar: '', posts: [] };
  localStorage.setItem('users', JSON.stringify(users));
  alert('–†–µ—î—Å—Ç—Ä–∞—Ü—ñ—è —É—Å–ø—ñ—à–Ω–∞! –£–≤—ñ–π–¥—ñ—Ç—å.');
  document.getElementById('registerForm').style.display = 'none';
  document.getElementById('loginForm').style.display = 'block';
};

document.getElementById('loginBtn').onclick = () => {
  const nick = document.getElementById('loginNickname').value.trim();
  const pass = document.getElementById('loginPassword').value.trim();
  if (!users[nick] || users[nick].password !== pass) return alert('–ù–µ–≤—ñ—Ä–Ω–∏–π –ø—Å–µ–≤–¥–æ–Ω—ñ–º –∞–±–æ –ø–∞—Ä–æ–ª—å');
  currentUser = nick;
  localStorage.setItem('currentUser', currentUser);
  authBox.style.display = 'none';
  newPostBox.style.display = 'block';
  document.getElementById('profileUsernameDisplay').textContent = currentUser;
  updateProfile();
  renderFeed();
};

// –î–æ–¥–∞–≤–∞–Ω–Ω—è –ø–æ—Å—Ç–∞ (—Ç–µ–ø–µ—Ä –∑ id —Ç–∞ —á–∞—Å–æ–º)
document.getElementById('addPost').onclick = () => {
  const text = document.getElementById('postText').value.trim();
  if (!text) return alert('–ù–∞–ø–∏—à—ñ—Ç—å —Ç–µ–∫—Å—Ç');
  if (!currentUser) return alert('–°–ø–æ—á–∞—Ç–∫—É —É–≤—ñ–π–¥—ñ—Ç—å');

  const post = {
    id: Date.now().toString(),
    text,
    time: new Date().toISOString(),
    likes: 0,
    likedBy: [],
    comments: 0
  };

  users[currentUser].posts.unshift(post);
  localStorage.setItem('users', JSON.stringify(users));
  document.getElementById('postText').value = '';
  renderFeed();
  updateProfile();
};

// –†–µ–Ω–¥–µ—Ä feed (–≥–æ–ª–æ–≤–Ω–∞ —Å—Ç–æ—Ä—ñ–Ω–∫–∞)
function renderFeed() {
  feed.innerHTML = '';
  let delay = 0;

  Object.entries(users).forEach(([user, data]) => {
    data.posts.forEach(post => {
      const postEl = document.createElement('div');
      postEl.className = 'post';
      postEl.innerHTML = `
        <div class="post-header">
          <div class="avatar" style="${data.avatar ? `background-image:url(${data.avatar})` : ''}"></div>
          <div>
            <div class="username">${user}</div>
            <div style="font-size:0.85rem;color:var(--text-sec);">
              ${new Date(post.time).toLocaleString('uk-UA',{hour:'2-digit',minute:'2-digit',day:'numeric',month:'short'})}
            </div>
          </div>
        </div>
        <div class="post-content">${post.text.replace(/\n/g,'<br>')}</div>
        <div class="post-footer">
          <div class="actions">
            <button class="action-btn ${post.likedBy.includes(currentUser)?'liked':''}" data-action="like" data-id="${post.id}">
              ‚ù§Ô∏è <span>${post.likes}</span>
            </button>
            <button class="action-btn" data-action="comment" data-id="${post.id}">
              üí¨ <span>${post.comments}</span>
            </button>
            <div class="reactions">
              <button class="action-btn" data-action="react" data-id="${post.id}">üòÄ –†–µ–∞–∫—Ü—ñ—è</button>
              <div class="emoji-picker" id="picker-${post.id}">
                <span class="emoji" data-emoji="‚ù§Ô∏è">‚ù§Ô∏è</span>
                <span class="emoji" data-emoji="üòÇ">üòÇ</span>
                <span class="emoji" data-emoji="üòÆ">üòÆ</span>
                <span class="emoji" data-emoji="üò¢">üò¢</span>
                <span class="emoji" data-emoji="üôå">üôå</span>
                <span class="emoji" data-emoji="üî•">üî•</span>
              </div>
            </div>
          </div>
        </div>
      `;
      feed.appendChild(postEl);
      setTimeout(() => postEl.classList.add('visible'), delay);
      delay += 100;
    });
  });

  attachInteractions();
}

function attachInteractions() {
  document.querySelectorAll('[data-action="like"]').forEach(btn => {
    btn.onclick = () => toggleLike(btn.dataset.id, btn);
  });

  document.querySelectorAll('[data-action="comment"]').forEach(btn => {
    btn.onclick = () => document.getElementById('commentsModal').classList.add('active');
  });

  document.querySelectorAll('[data-action="react"]').forEach(btn => {
    btn.onclick = e => {
      e.stopPropagation();
      const picker = document.getElementById(`picker-${btn.dataset.id}`);
      picker.classList.toggle('active');
      document.querySelectorAll('.emoji-picker.active').forEach(p => { if (p !== picker) p.classList.remove('active'); });
    };
  });

  document.querySelectorAll('.emoji').forEach(em => {
    em.onclick = e => {
      e.stopPropagation();
      const picker = em.closest('.emoji-picker');
      const postId = picker.id.replace('picker-', '');
      console.log(`–†–µ–∞–∫—Ü—ñ—è: ${em.dataset.emoji} –Ω–∞ –ø–æ—Å—Ç ${postId}`);
      // –ú–æ–∂–Ω–∞ –¥–æ–¥–∞—Ç–∏ –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è —Ä–µ–∞–∫—Ü—ñ–π
      picker.classList.remove('active');
    };
  });

  document.addEventListener('click', e => {
    if (!e.target.closest('.reactions')) {
      document.querySelectorAll('.emoji-picker.active').forEach(p => p.classList.remove('active'));
    }
  });
}

function toggleLike(postId, btn) {
  let found = false;
  Object.values(users).forEach(u => {
    u.posts.forEach(p => {
      if (p.id === postId) {
        if (!p.likedBy.includes(currentUser)) {
          p.likedBy.push(currentUser);
          p.likes++;
          btn.classList.add('liked');
        } else {
          p.likedBy = p.likedBy.filter(x => x !== currentUser);
          p.likes = Math.max(0, p.likes - 1);
          btn.classList.remove('liked');
        }
        btn.querySelector('span').textContent = p.likes;
        found = true;
      }
    });
  });
  if (found) localStorage.setItem('users', JSON.stringify(users));
}

// –ü—Ä–æ—Ñ—ñ–ª—å + –∞–≤–∞—Ç–∞—Ä–∫–∞ (–∑ —Ç–≤–æ–≥–æ –∫–æ–¥—É)
function updateProfile() {
  if (!currentUser) return;
  const u = users[currentUser];
  document.getElementById('postsCount').textContent = `–ü–æ—Å—Ç–∏: ${u.posts.length}`;
  document.getElementById('profileBio').textContent = u.bio || '–ù–µ–º–∞—î –æ–ø–∏—Å—É';
  const avatarEl = document.getElementById('profileAvatar');
  avatarEl.style.backgroundImage = u.avatar ? `url(${u.avatar})` : 'none';
}

document.getElementById('profileAvatar').onclick = () => currentUser && document.getElementById('avatarInput').click();

document.getElementById('avatarInput').onchange = e => {
  const file = e.target.files[0];
  if (!file) return;
  const reader = new FileReader();
  reader.onload = ev => {
    users[currentUser].avatar = ev.target.result;
    localStorage.setItem('users', JSON.stringify(users));
    updateProfile();
    renderFeed();
  };
  reader.readAsDataURL(file);
};

// –ú–æ–¥–∞–ª–∫–∞ —Ä–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è –ø—Ä–æ—Ñ—ñ–ª—é
const modal = document.getElementById('editProfileModal');
document.getElementById('editProfileBtn').onclick = () => modal.classList.add('active');
document.getElementById('closeModal').onclick = () => modal.classList.remove('active');
document.getElementById('saveProfileEdit').onclick = () => {
  const bio = document.getElementById('editBio').value.trim();
  if (currentUser) {
    users[currentUser].bio = bio;
    localStorage.setItem('users', JSON.stringify(users));
    updateProfile();
  }
  modal.classList.remove('active');
};

// –¢–µ–º–∞
document.getElementById('toggleTheme').onclick = () => {
  document.body.classList.toggle('light');
  localStorage.setItem('theme', document.body.classList.contains('light') ? 'light' : 'dark');
};

// –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è
if (localStorage.getItem('theme') === 'light') document.body.classList.add('light');

if (currentUser && users[currentUser]) {
  authBox.style.display = 'none';
  newPostBox.style.display = 'block';
  document.getElementById('profileUsernameDisplay').textContent = currentUser;
  updateProfile();
  renderFeed();
}
</script>
</body>
</html>
