<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>FANTASYAS</title>
  <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@500;600;700;800&display=swap" rel="stylesheet"/>
  <style>
    * {margin:0; padding:0; box-sizing:border-box;}
    body {
      font-family:'Manrope',sans-serif; 
      background:#000; 
      color:#fff; 
      min-height:100vh; 
      overflow-x:hidden;
      transition: background 0.4s, color 0.4s;
    }
    body.light {
      background: #f8f9fa;
      color: #111;
    }
    body.large-font {
      font-size: 1.12rem;
    }
    .top-bar {
      position:fixed; top:0; left:0; right:0; height:80px; 
      display:flex; align-items:center; justify-content:space-between; 
      padding:0 20px; 
      background:rgba(0,0,0,0.4); backdrop-filter:blur(10px); 
      border-bottom:1px solid rgba(255,255,255,0.08); z-index:1000;
    }
    body.light .top-bar {background:rgba(255,255,255,0.7); border-bottom:1px solid rgba(0,0,0,0.08);}
    .site-name {
      font-size:1.8rem; font-weight:800; 
      background:linear-gradient(90deg,#fff,#aaa); 
      -webkit-background-clip:text; -webkit-text-fill-color:transparent;
    }
    body.light .site-name {background:linear-gradient(90deg,#000,#444); -webkit-text-fill-color:transparent;}
    .burger {width:30px; height:22px; display:flex; flex-direction:column; justify-content:space-between; cursor:pointer;}
    .burger span {height:3px; width:100%; background:#fff; border-radius:3px; transition:0.4s;}
    body.light .burger span {background:#000;}
    .burger.active span:nth-child(1){transform:rotate(45deg) translate(5px,5px);}
    .burger.active span:nth-child(2){opacity:0;}
    .burger.active span:nth-child(3){transform:rotate(-45deg) translate(6px,-6px);}
    .sidebar {
      position:fixed; top:0; left:-280px; width:280px; height:100%; 
      background:#000; padding:120px 40px 40px; 
      border-right:1px solid rgba(255,255,255,0.06); transition:0.4s; z-index:900;
    }
    body.light .sidebar {background:#fff; border-right:1px solid rgba(0,0,0,0.06);}
    .sidebar.active {left:0;}
    .sidebar a {
      display:block; color:#aaa; text-decoration:none; 
      font-size:1.25rem; font-weight:700; margin:1.4rem 0; 
      transition:0.3s; cursor:pointer;
    }
    body.light .sidebar a {color:#555;}
    .sidebar a:hover{color:#fff; transform:translateX(8px);}
    body.light .sidebar a:hover {color:#000;}
    .main-content {margin-top:100px; padding:20px 25px;}
    .section {display:none; padding:0 8px;}
    .section.active {display:block;}
    .login-box, .new-post, .settings, .profile-edit-form {
      margin-bottom:20px; display:flex; flex-direction:column; gap:12px;
      background:rgba(255,255,255,0.05); border:1px solid rgba(255,255,255,0.1); 
      border-radius:16px; padding:20px;
    }
    body.light .login-box, body.light .new-post, body.light .settings, body.light .profile-edit-form {
      background:rgba(0,0,0,0.03); border:1px solid rgba(0,0,0,0.08);
    }
    input, textarea {
      padding:12px; border-radius:12px; 
      border:1px solid rgba(255,255,255,0.1); 
      background:rgba(255,255,255,0.08); color:#fff; 
      outline:none; font-family:'Manrope',sans-serif; resize:vertical;
    }
    body.light input, body.light textarea {
      background:#fff; color:#000; border:1px solid #ddd;
    }
    input::placeholder, textarea::placeholder {color:#aaa;}
    button {
      width:fit-content; padding:10px 18px; border:none; border-radius:12px; 
      background:#fff; color:#000; font-weight:700; cursor:pointer; transition:0.2s;
    }
    body.light button {background:#000; color:#fff;}
    button:hover {opacity:0.9;}
    .danger-btn {background:#c53030 !important; color:#fff !important;}
    .danger-btn:hover {background:#a71d2a !important;}
    .feed {display:flex; flex-direction:column; gap:20px;}
    .post {
      background:rgba(255,255,255,0.05); border:1px solid rgba(255,255,255,0.1); 
      border-radius:16px; padding:18px;
    }
    body.light .post {background:rgba(0,0,0,0.03); border:1px solid rgba(0,0,0,0.08);}
    .post-header {display:flex; align-items:center; gap:12px; margin-bottom:12px;}
    .avatar {
      width:48px; height:48px; background:#444; border-radius:50%; 
      background-size:cover; background-position:center;
    }
    body.light .avatar {background:#ccc;}
    .username {font-weight:700; font-size:1.05rem;}
    .post-content {font-size:0.95rem; line-height:1.5; margin-bottom:12px;}
    .post-meta {color:#888; font-size:0.8rem; margin-top:4px;}
    .post-footer {display:flex; gap:20px; margin-top:12px;}
    .post-footer button {background:none; border:none; color:#aaa; cursor:pointer; display:flex; align-items:center; gap:6px;}
    body.light .post-footer button {color:#666;}
    .post-footer button:hover {color:#fff;}
    body.light .post-footer button:hover {color:#000;}
    .heart, .bubble, .star {
      width:18px; height:18px; display:inline-block; background-size:contain; background-repeat:no-repeat;
    }
    .heart {background:url('data:image/svg+xml;utf8,<svg fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 21C12 21 4 13.5 4 8.5C4 5.42 6.42 3 9.5 3C11.24 3 12.91 3.81 13.5 5.09C14.09 3.81 15.76 3 17.5 3C20.58 3 23 5.42 23 8.5C23 13.5 15 21 15 21H12Z"/></svg>') center/contain;}
    .bubble {background:url('data:image/svg+xml;utf8,<svg fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2z"/></svg>') center/contain;}
    .star {background:url('data:image/svg+xml;utf8,<svg fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/></svg>') center/contain;}
    .liked .heart {color:#ff3366; fill:#ff3366;}
    .favorited .star {color:#ffc107; fill:#ffc107;}
    .comments-section {margin-top:16px; padding-top:12px; border-top:1px solid rgba(255,255,255,0.08);}
    body.light .comments-section {border-top:1px solid rgba(0,0,0,0.08);}
    .comment {font-size:0.9rem; margin:8px 0; padding-left:12px; border-left:3px solid #555;}
    body.light .comment {border-left:3px solid #aaa;}
    .comment strong {color:#ddd;}
    body.light .comment strong {color:#333;}
    .comment-input {display:flex; gap:10px; margin-top:12px;}
    .comment-input input {flex:1;}
    .modal {
      position:fixed; inset:0; background:rgba(0,0,0,0.7); 
      display:none; align-items:center; justify-content:center; z-index:2000;
    }
    .modal.active {display:flex;}
    .modal-content {
      background:#111; width:90%; max-width:500px; border-radius:16px; 
      padding:28px; position:relative; border:1px solid rgba(255,255,255,0.15);
    }
    body.light .modal-content {background:#fff; border:1px solid #ddd; color:#000;}
    .close-modal {position:absolute; top:12px; right:16px; font-size:1.8rem; cursor:pointer; color:#aaa;}
    body.light .close-modal {color:#555;}
    .profile-header {display:flex; align-items:center; gap:20px; margin-bottom:30px; flex-wrap:wrap;}
    .profile-avatar {width:120px; height:120px; border-radius:50%; background:#333; background-size:cover;}
    body.light .profile-avatar {background:#ddd;}
    .profile-info h2 {font-size:2rem;}
    .profile-bio {color:#bbb; margin:12px 0; line-height:1.6;}
    body.light .profile-bio {color:#444;}
    .profile-stats {display:grid; grid-template-columns:repeat(auto-fit, minmax(140px, 1fr)); gap:16px; margin:30px 0;}
    .stat-card {
      background:rgba(255,255,255,0.06); padding:20px; border-radius:12px; 
      text-align:center; border:1px solid rgba(255,255,255,0.08);
    }
    body.light .stat-card {background:rgba(0,0,0,0.04); border:1px solid rgba(0,0,0,0.1);}
    .stat-number {font-size:2.2rem; font-weight:800;}
    .stat-label {color:#aaa; font-size:0.95rem;}
    body.light .stat-label {color:#666;}
    @media(max-width:900px){
      .sidebar{width:100%; left:-100%; padding:100px 20px; border-right:none; border-bottom:1px solid rgba(255,255,255,0.06);}
      .sidebar.active{left:0;}
    }
  </style>
</head>
<body>

<div class="top-bar">
  <div class="burger" id="burger"><span></span><span></span><span></span></div>
  <div class="site-name">FANTASYAS</div>
</div>

<nav class="sidebar" id="sidebar">
  <a data-section="home">–ì–æ–ª–æ–≤–Ω–∞</a>
  <a data-section="profile">–ü—Ä–æ—Ñ—ñ–ª—å</a>
  <a data-section="settings">–ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è</a>
  <a href="#">–ü—Ä–æ –Ω–∞—Å</a>
  <a href="#">–ü–æ—Å–ª—É–≥–∏</a>
  <a href="#">–ü–æ—Ä—Ç—Ñ–æ–ª—ñ–æ</a>
  <a href="#">–ö–æ–Ω—Ç–∞–∫—Ç–∏</a>
</nav>

<main class="main-content">

  <!-- ‚îÄ‚îÄ –ì–æ–ª–æ–≤–Ω–∞ ‚îÄ‚îÄ -->
  <div id="home" class="section active">
    <div class="login-box" id="loginBox">
      <input type="text" id="usernameInput" placeholder="–í–≤–µ–¥—ñ—Ç—å —Å–≤–æ—î —ñ–º'—è">
      <button id="saveUsername">–ü–æ—á–∞—Ç–∏</button>
    </div>

    <div class="new-post" id="newPostBox" style="display:none;">
      <textarea id="postText" placeholder="–©–æ —É —Ç–µ–±–µ –Ω–∞ –¥—É–º—Ü—ñ?..." rows="4"></textarea>
      <button id="addPost">–û–ø—É–±–ª—ñ–∫—É–≤–∞—Ç–∏</button>
    </div>

    <div class="feed" id="feed"></div>
  </div>

  <!-- ‚îÄ‚îÄ –ü—Ä–æ—Ñ—ñ–ª—å ‚îÄ‚îÄ -->
  <div id="profile" class="section">
    <div class="profile-header">
      <div class="profile-avatar" id="profileAvatar"></div>
      <div>
        <h2 id="profileUsernameDisplay"></h2>
        <p class="profile-meta">–ó–∞—Ä–µ—î—Å—Ç—Ä–æ–≤–∞–Ω–æ: <span id="registerDate"></span></p>
      </div>
      <button id="editProfileBtn">–†–µ–¥–∞–≥—É–≤–∞—Ç–∏ –ø—Ä–æ—Ñ—ñ–ª—å</button>
    </div>

    <p class="profile-bio" id="profileBio">–ù–µ–º–∞—î –æ–ø–∏—Å—É...</p>

    <div class="profile-stats">
      <div class="stat-card"><div class="stat-number" id="postCount">0</div><div class="stat-label">–ø–æ—Å—Ç—ñ–≤</div></div>
      <div class="stat-card"><div class="stat-number" id="likeCount">0</div><div class="stat-label">–ª–∞–π–∫—ñ–≤ –æ—Ç—Ä–∏–º–∞–Ω–æ</div></div>
      <div class="stat-card"><div class="stat-number" id="commentCount">0</div><div class="stat-label">–∫–æ–º–µ–Ω—Ç–∞—Ä—ñ–≤</div></div>
      <div class="stat-card"><div class="stat-number" id="favoriteCount">0</div><div class="stat-label">–≤ –æ–±—Ä–∞–Ω–æ–º—É</div></div>
    </div>

    <h3 style="margin:40px 0 20px;">–¢–≤–æ—ó –ø–æ—Å—Ç–∏</h3>
    <div id="profilePosts" class="feed"></div>
  </div>

  <!-- ‚îÄ‚îÄ –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è ‚îÄ‚îÄ -->
  <div id="settings" class="section">
    <h2>–ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è</h2>
    <div class="settings">
      <label>–Ü–º'—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞</label>
      <input type="text" id="changeUsername" placeholder="–ù–æ–≤–µ —ñ–º'—è">

      <label>–ê–≤–∞—Ç–∞—Ä (–∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ –∑ —Ñ–∞–π–ª—É)</label>
      <input type="file" id="avatarFileInput" accept="image/*">

      <label>–ê–±–æ –ø–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –∞–≤–∞—Ç–∞—Ä (URL)</label>
      <input type="url" id="changeAvatar" placeholder="https://example.com/avatar.jpg">

      <label>–ü—Ä–æ —Å–µ–±–µ / –±—ñ–æ</label>
      <textarea id="changeBio" placeholder="–†–æ–∑–∫–∞–∂–∏ –ø—Ä–æ —Å–µ–±–µ..." rows="4"></textarea>

      <div style="margin:20px 0;">
        <label>–¢–µ–º–∞:</label><br>
        <select id="themeSelect">
          <option value="dark">–¢–µ–º–Ω–∞ (–∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º)</option>
          <option value="light">–°–≤—ñ—Ç–ª–∞</option>
        </select>
      </div>

      <div style="margin:20px 0;">
        <label>–†–æ–∑–º—ñ—Ä —Ç–µ–∫—Å—Ç—É:</label><br>
        <select id="fontSizeSelect">
          <option value="normal">–ó–≤–∏—á–∞–π–Ω–∏–π</option>
          <option value="large">–í–µ–ª–∏–∫–∏–π</option>
        </select>
      </div>

      <button id="saveSettings">–ó–±–µ—Ä–µ–≥—Ç–∏ –∑–º—ñ–Ω–∏</button>

      <hr style="margin:40px 0; border-color:rgba(255,255,255,0.1);">

      <button class="danger-btn" id="logoutBtn">–í–∏–π—Ç–∏ –∑ –∞–∫–∞—É–Ω—Ç—É</button>
      <button class="danger-btn" id="deleteAccountBtn">–í–∏–¥–∞–ª–∏—Ç–∏ –∞–∫–∞—É–Ω—Ç</button>
      <button class="danger-btn" id="clearAllData">–û—á–∏—Å—Ç–∏—Ç–∏ –í–°–Ü –¥–∞–Ω—ñ —Å–∞–π—Ç—É</button>
    </div>
  </div>

</main>

<!-- –ú–æ–¥–∞–ª–∫–∞ —Ä–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è –ø—Ä–æ—Ñ—ñ–ª—é -->
<div class="modal" id="editProfileModal">
  <div class="modal-content">
    <span class="close-modal" id="closeModal">√ó</span>
    <h2>–†–µ–¥–∞–≥—É–≤–∞—Ç–∏ –ø—Ä–æ—Ñ—ñ–ª—å</h2>
    <div class="profile-edit-form">
      <label>–ê–≤–∞—Ç–∞—Ä (–∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ –∑ —Ñ–∞–π–ª—É)</label>
      <input type="file" id="editAvatarFile" accept="image/*">

      <label>–ê–±–æ –ø–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –∞–≤–∞—Ç–∞—Ä (URL)</label>
      <input type="url" id="editAvatar" placeholder="https://...">

      <label>–ë—ñ–æ</label>
      <textarea id="editBio" rows="5"></textarea>

      <button id="saveProfileEdit">–ó–±–µ—Ä–µ–≥—Ç–∏</button>
    </div>
  </div>
</div>

<script>
// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const KEY = {
  USERNAME: 'fantasyasUsername',
  USER: 'fantasyasUserData',
  POSTS: 'fantasyas_posts_v3'
};

let username = localStorage.getItem(KEY.USERNAME);
let userData = JSON.parse(localStorage.getItem(KEY.USER)) || {
  avatar: '',
  bio: '',
  registered: new Date().toISOString().split('T')[0],
  favorites: []
};
let posts = JSON.parse(localStorage.getItem(KEY.POSTS)) || [];

// –ï–ª–µ–º–µ–Ω—Ç–∏
const burger = document.getElementById('burger');
const sidebar = document.getElementById('sidebar');
const sections = document.querySelectorAll('.section');
const loginBox = document.getElementById('loginBox');
const newPostBox = document.getElementById('newPostBox');
const feed = document.getElementById('feed');
const postText = document.getElementById('postText');
const modal = document.getElementById('editProfileModal');

// ‚îÄ‚îÄ –ë—É—Ä–≥–µ—Ä —Ç–∞ –Ω–∞–≤—ñ–≥–∞—Ü—ñ—è ‚îÄ‚îÄ
burger.addEventListener('click', () => {
  burger.classList.toggle('active');
  sidebar.classList.toggle('active');
});

function showSection(id) {
  sections.forEach(s => s.classList.remove('active'));
  document.getElementById(id).classList.add('active');
  sidebar.classList.remove('active');
  burger.classList.remove('active');
  if (id === 'profile') updateProfile();
}

document.querySelectorAll('[data-section]').forEach(el => {
  el.addEventListener('click', () => showSection(el.dataset.section));
});

// ‚îÄ‚îÄ –¢–µ–º–∞ —Ç–∞ —à—Ä–∏—Ñ—Ç ‚îÄ‚îÄ
function applyPreferences() {
  const theme = localStorage.getItem('fantasyasTheme') || 'dark';
  const font = localStorage.getItem('fantasyasFontSize') || 'normal';
  document.body.classList.toggle('light', theme === 'light');
  document.body.classList.toggle('large-font', font === 'large');
  document.getElementById('themeSelect').value = theme;
  document.getElementById('fontSizeSelect').value = font;
}

applyPreferences();

// ‚îÄ‚îÄ –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—è ‚îÄ‚îÄ
if (username) {
  loginBox.style.display = 'none';
  newPostBox.style.display = 'flex';
  applyPreferences();
} else {
  newPostBox.style.display = 'none';
}

document.getElementById('saveUsername').addEventListener('click', () => {
  const val = document.getElementById('usernameInput').value.trim();
  if (!val) return alert('–í–≤–µ–¥–∏ —ñ–º‚Äô—è');
  username = val;
  localStorage.setItem(KEY.USERNAME, username);
  if (!userData.registered) userData.registered = new Date().toISOString().split('T')[0];
  localStorage.setItem(KEY.USER, JSON.stringify(userData));
  loginBox.style.display = 'none';
  newPostBox.style.display = 'flex';
  renderPosts();
});

// ‚îÄ‚îÄ –î–æ–¥–∞–≤–∞–Ω–Ω—è –ø–æ—Å—Ç–∞ ‚îÄ‚îÄ
document.getElementById('addPost').addEventListener('click', () => {
  const text = postText.value.trim();
  if (!text || !username) return;
  posts.unshift({
    id: Date.now(),
    username,
    text,
    likes: 0,
    likedBy: [],
    comments: [],
    created: new Date().toISOString()
  });
  savePosts();
  postText.value = '';
  renderPosts();
});

// ‚îÄ‚îÄ –û–±—Ä–æ–±–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –∞–≤–∞—Ç–∞—Ä–∫–∏ ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function handleAvatarUpload(inputEl, isModal = false) {
  inputEl.addEventListener('change', e => {
    const file = e.target.files[0];
    if (!file) return;

    if (file.size > 2 * 1024 * 1024) {
      alert('–ó–æ–±—Ä–∞–∂–µ–Ω–Ω—è –∑–∞–Ω–∞–¥—Ç–æ –≤–µ–ª–∏–∫–µ (–º–∞–∫—Å–∏–º—É–º ~2 –ú–ë)');
      e.target.value = '';
      return;
    }

    const reader = new FileReader();
    reader.onload = ev => {
      userData.avatar = ev.target.result; // base64
      localStorage.setItem(KEY.USER, JSON.stringify(userData));
      updateProfile();
      renderPosts();

      if (isModal) {
        modal.classList.remove('active');
      }

      alert('–ê–≤–∞—Ç–∞—Ä –æ–Ω–æ–≤–ª–µ–Ω–æ!');
      e.target.value = '';
    };
    reader.readAsDataURL(file);
  });
}

handleAvatarUpload(document.getElementById('avatarFileInput'), false);
handleAvatarUpload(document.getElementById('editAvatarFile'), true);

// ‚îÄ‚îÄ –†–µ–Ω–¥–µ—Ä —Å—Ç—Ä—ñ—á–∫–∏ ‚îÄ‚îÄ
function renderPosts(container = feed) {
  container.innerHTML = '';
  posts.forEach(post => {
    const isLiked = post.likedBy?.includes(username);
    const isFavorite = userData.favorites?.includes(post.id);
    const postEl = document.createElement('div');
    postEl.className = 'post';
    postEl.innerHTML = `
      <div class="post-header">
        <div class="avatar" style="background-image:url('${getAvatar(post.username)}')"></div>
        <div class="username">${post.username}</div>
      </div>
      <div class="post-content">${post.text.replace(/\n/g, '<br>')}</div>
      <div class="post-meta">${new Date(post.created).toLocaleString('uk-UA', {dateStyle:'short', timeStyle:'short'})}</div>
      <div class="post-footer">
        <button class="like-btn ${isLiked ? 'liked' : ''}">
          <span class="heart"></span> ${post.likes || 0}
        </button>
        <button class="comment-btn">
          <span class="bubble"></span> ${post.comments?.length || 0}
        </button>
        <button class="favorite-btn ${isFavorite ? 'favorited' : ''}">
          <span class="star"></span> ${isFavorite ? '–í –æ–±—Ä–∞–Ω–æ–º—É' : '–î–æ–¥–∞—Ç–∏ –≤ –æ–±—Ä–∞–Ω–µ'}
        </button>
      </div>
      <div class="comments-section" id="comments-${post.id}"></div>
      <div class="comment-input">
        <input type="text" placeholder="–ö–æ–º–µ–Ω—Ç–∞—Ä..." class="comment-inp"/>
        <button class="add-comment-btn">‚Üí</button>
      </div>
    `;

    postEl.querySelector('.like-btn').addEventListener('click', () => {
      if (!username) return alert('–£–≤—ñ–π–¥–∏');
      if (!post.likedBy) post.likedBy = [];
      const idx = post.likedBy.indexOf(username);
      if (idx === -1) {
        post.likedBy.push(username);
        post.likes = (post.likes || 0) + 1;
      } else {
        post.likedBy.splice(idx, 1);
        post.likes--;
      }
      savePosts();
      renderPosts(container);
      if (container !== feed) updateProfile();
    });

    const inp = postEl.querySelector('.comment-inp');
    const btn = postEl.querySelector('.add-comment-btn');
    btn.addEventListener('click', () => {
      const text = inp.value.trim();
      if (!text || !username) return;
      if (!post.comments) post.comments = [];
      post.comments.push({user: username, text, time: Date.now()});
      inp.value = '';
      savePosts();
      renderComments(post.id, postEl.querySelector(`#comments-${post.id}`));
      renderPosts(container);
    });

    postEl.querySelector('.favorite-btn').addEventListener('click', () => {
      if (!username) return alert('–£–≤—ñ–π–¥–∏');
      if (!userData.favorites) userData.favorites = [];
      const idx = userData.favorites.indexOf(post.id);
      if (idx === -1) {
        userData.favorites.push(post.id);
      } else {
        userData.favorites.splice(idx, 1);
      }
      localStorage.setItem(KEY.USER, JSON.stringify(userData));
      renderPosts(container);
      if (container !== feed) updateProfile();
    });

    renderComments(post.id, postEl.querySelector(`#comments-${post.id}`));
    container.prepend(postEl);
  });
}

function renderComments(postId, container) {
  container.innerHTML = '';
  const post = posts.find(p => p.id === postId);
  (post?.comments || []).forEach(c => {
    const div = document.createElement('div');
    div.className = 'comment';
    div.innerHTML = `<strong>${c.user}</strong>: ${c.text}`;
    container.appendChild(div);
  });
}

function getAvatar(uname) {
  if (uname === username) return userData.avatar || '';
  return '';
}

// ‚îÄ‚îÄ –ü—Ä–æ—Ñ—ñ–ª—å ‚îÄ‚îÄ
function updateProfile() {
  if (!username) return;

  document.getElementById('profileUsernameDisplay').textContent = username;
  document.getElementById('registerDate').textContent = userData.registered || '–Ω–µ–≤—ñ–¥–æ–º–æ';
  document.getElementById('profileBio').textContent = userData.bio || '–ù–µ–º–∞—î –æ–ø–∏—Å—É...';

  const avatarEl = document.getElementById('profileAvatar');
  avatarEl.style.backgroundImage = userData.avatar ? `url('${userData.avatar}')` : '';

  let postCount = 0, likeCount = 0, commentCount = 0;
  posts.forEach(p => {
    if (p.username === username) {
      postCount++;
      likeCount += p.likes || 0;
      commentCount += p.comments?.length || 0;
    }
  });

  document.getElementById('postCount').textContent = postCount;
  document.getElementById('likeCount').textContent = likeCount;
  document.getElementById('commentCount').textContent = commentCount;
  document.getElementById('favoriteCount').textContent = userData.favorites?.length || 0;

  const profilePosts = document.getElementById('profilePosts');
  profilePosts.innerHTML = '';
  renderPosts(profilePosts);  // –ø–æ–∫–∞–∑—É—î–º–æ —Ç—ñ–ª—å–∫–∏ —Å–≤–æ—ó –ø–æ—Å—Ç–∏
}

// ‚îÄ‚îÄ –ó–±–µ—Ä–µ–∂–µ–Ω–Ω—è –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω—å (URL + –±—ñ–æ + —ñ–º'—è) ‚îÄ‚îÄ
document.getElementById('saveSettings').addEventListener('click', () => {
  const newName = document.getElementById('changeUsername').value.trim();
  const newAvatarUrl = document.getElementById('changeAvatar').value.trim();
  const newBio = document.getElementById('changeBio').value.trim();

  if (newName && newName !== username) {
    if (!confirm(`–ó–º—ñ–Ω–∏—Ç–∏ —ñ–º'—è –Ω–∞ "${newName}"?`)) return;
    posts.forEach(p => {
      if (p.username === username) p.username = newName;
      p.comments?.forEach(c => { if (c.user === username) c.user = newName; });
    });
    username = newName;
    localStorage.setItem(KEY.USERNAME, username);
  }

  // —è–∫—â–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –≤–≤—ñ–≤ URL ‚Äî –ø–µ—Ä–µ–∑–∞–ø–∏—Å—É—î–º–æ (–∞–ª–µ —Ñ–∞–π–ª –º–∞—î –≤–∏—â–∏–π –ø—Ä—ñ–æ—Ä–∏—Ç–µ—Ç, –±–æ –∑–∞–≤–∞–Ω—Ç–∞–∂—É—î—Ç—å—Å—è –æ–∫—Ä–µ–º–æ)
  if (newAvatarUrl) {
    userData.avatar = newAvatarUrl;
  }

  if (newBio !== userData.bio) {
    userData.bio = newBio;
  }

  localStorage.setItem(KEY.USER, JSON.stringify(userData));
  localStorage.setItem(KEY.POSTS, JSON.stringify(posts));

  alert('–ó–º—ñ–Ω–∏ –∑–±–µ—Ä–µ–∂–µ–Ω–æ!');
  updateProfile();
  renderPosts();
});

document.getElementById('themeSelect').addEventListener('change', e => {
  localStorage.setItem('fantasyasTheme', e.target.value);
  applyPreferences();
});

document.getElementById('fontSizeSelect').addEventListener('change', e => {
  localStorage.setItem('fantasyasFontSize', e.target.value);
  applyPreferences();
});

document.getElementById('logoutBtn').addEventListener('click', () => {
  if (confirm('–í–∏–π—Ç–∏?')) {
    localStorage.removeItem(KEY.USERNAME);
    location.reload();
  }
});

document.getElementById('deleteAccountBtn').addEventListener('click', () => {
  if (confirm('–í–∏–¥–∞–ª–∏—Ç–∏ –∞–∫–∞—É–Ω—Ç? –í—Å—ñ —Ç–≤–æ—ó –ø–æ—Å—Ç–∏ —Ç–∞ –∫–æ–º–µ–Ω—Ç–∞—Ä—ñ –±—É–¥—É—Ç—å –≤–∏–¥–∞–ª–µ–Ω—ñ!')) {
    posts = posts.filter(p => p.username !== username);
    localStorage.removeItem(KEY.USERNAME);
    localStorage.removeItem(KEY.USER);
    savePosts();
    location.reload();
  }
});

document.getElementById('clearAllData').addEventListener('click', () => {
  if (confirm('–û—á–∏—Å—Ç–∏—Ç–∏ –í–°–Ü –¥–∞–Ω—ñ –Ω–∞–∑–∞–≤–∂–¥–∏?')) {
    localStorage.clear();
    location.reload();
  }
});

// ‚îÄ‚îÄ –ú–æ–¥–∞–ª–∫–∞ —Ä–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è ‚îÄ‚îÄ
document.getElementById('editProfileBtn').addEventListener('click', () => {
  document.getElementById('editAvatar').value = '';
  document.getElementById('editBio').value = userData.bio || '';
  modal.classList.add('active');
});

document.getElementById('closeModal').addEventListener('click', () => modal.classList.remove('active'));

document.getElementById('saveProfileEdit').addEventListener('click', () => {
  const url = document.getElementById('editAvatar').value.trim();
  const bio = document.getElementById('editBio').value.trim();

  if (url) userData.avatar = url;
  userData.bio = bio;

  localStorage.setItem(KEY.USER, JSON.stringify(userData));
  modal.classList.remove('active');
  updateProfile();
  renderPosts();
  alert('–ü—Ä–æ—Ñ—ñ–ª—å –æ–Ω–æ–≤–ª–µ–Ω–æ!');
});

// ‚îÄ‚îÄ –ó–±–µ—Ä–µ–∂–µ–Ω–Ω—è –ø–æ—Å—Ç—ñ–≤ ‚îÄ‚îÄ
function savePosts() {
  localStorage.setItem(KEY.POSTS, JSON.stringify(posts));
}

// –ü–æ—á–∞—Ç–æ–∫
if (username) {
  renderPosts();
  updateProfile();
}
</script>
</body>
</html><script>
const KEY = {
  USERNAME: 'fantasyasUsername',
  USER: 'fantasyasUserData',
  POSTS: 'fantasyas_posts_v4'
};

let username = localStorage.getItem(KEY.USERNAME);
let userData = JSON.parse(localStorage.getItem(KEY.USER)) || {
  avatar: '',
  bio: '',
  registered: new Date().toISOString().split('T')[0],
  favorites: []
};
let posts = JSON.parse(localStorage.getItem(KEY.POSTS)) || [];

const feed = document.getElementById('feed');
const postText = document.getElementById('postText');

function savePosts() {
  localStorage.setItem(KEY.POSTS, JSON.stringify(posts));
}

function renderPosts(container = feed, onlyUser = false) {
  container.innerHTML = '';

  posts
    .filter(p => !onlyUser || p.username === username)
    .forEach(post => {

      if (!post.reactions) {
        post.reactions = { "‚ù§Ô∏è":0, "üî•":0, "üòÇ":0, "üòÆ":0 };
      }

      const isLiked = post.likedBy?.includes(username);
      const isFavorite = userData.favorites?.includes(post.id);

      const postEl = document.createElement('div');
      postEl.className = 'post';

      postEl.innerHTML = `
        <div class="post-header">
          <div class="avatar" style="background-image:url('${getAvatar(post.username)}')"></div>
          <div class="username">${post.username}</div>
        </div>

        <div class="post-content" id="content-${post.id}">
          ${post.text.replace(/\n/g,'<br>')}
        </div>

        <div class="post-meta">
          ${new Date(post.created).toLocaleString('uk-UA',{dateStyle:'short',timeStyle:'short'})}
        </div>

        <div class="post-footer">
          <button class="like-btn ${isLiked?'liked':''}">
            ‚ù§Ô∏è ${post.likes||0}
          </button>

          <button class="comment-btn">
            üí¨ ${post.comments?.length||0}
          </button>

          <button class="favorite-btn ${isFavorite?'favorited':''}">
            ‚≠ê
          </button>

          ${post.username===username?'<button class="edit-btn">‚úèÔ∏è</button>':''}
        </div>

        <div style="margin-top:10px; display:flex; gap:8px;">
          ${Object.keys(post.reactions).map(e=>`
            <span class="emoji-btn" data-e="${e}" style="cursor:pointer;">
              ${e} ${post.reactions[e]}
            </span>
          `).join('')}
        </div>

        <div class="comments-section"></div>
      `;

      // LIKE
      postEl.querySelector('.like-btn').addEventListener('click',()=>{
        if(!username) return alert('–£–≤—ñ–π–¥–∏');
        if(!post.likedBy) post.likedBy=[];
        const i = post.likedBy.indexOf(username);
        if(i===-1){
          post.likedBy.push(username);
          post.likes=(post.likes||0)+1;
        }else{
          post.likedBy.splice(i,1);
          post.likes--;
        }
        savePosts();
        renderPosts(container,onlyUser);
      });

      // FAVORITE
      postEl.querySelector('.favorite-btn').addEventListener('click',()=>{
        if(!userData.favorites) userData.favorites=[];
        const i = userData.favorites.indexOf(post.id);
        if(i===-1) userData.favorites.push(post.id);
        else userData.favorites.splice(i,1);
        localStorage.setItem(KEY.USER,JSON.stringify(userData));
        renderPosts(container,onlyUser);
      });

      // REACTIONS
      postEl.querySelectorAll('.emoji-btn').forEach(btn=>{
        btn.addEventListener('click',()=>{
          const e = btn.dataset.e;
          post.reactions[e]++;
          savePosts();
          renderPosts(container,onlyUser);
        });
      });

      // EDIT
      if(post.username===username){
        postEl.querySelector('.edit-btn').addEventListener('click',()=>{
          const contentDiv = document.getElementById(`content-${post.id}`);
          const textarea = document.createElement('textarea');
          textarea.value = post.text;
          textarea.style.width='100%';
          textarea.style.marginTop='10px';

          const saveBtn = document.createElement('button');
          saveBtn.textContent='–ó–±–µ—Ä–µ–≥—Ç–∏';
          saveBtn.style.marginTop='8px';

          contentDiv.replaceWith(textarea);
          textarea.after(saveBtn);

          saveBtn.addEventListener('click',()=>{
            post.text = textarea.value.trim();
            savePosts();
            renderPosts(container,onlyUser);
          });
        });
      }

      container.appendChild(postEl);
    });
}

function getAvatar(uname){
  if(uname===username) return userData.avatar||'';
  return '';
}

// ADD POST
document.getElementById('addPost').addEventListener('click',()=>{
  const text = postText.value.trim();
  if(!text||!username) return;

  posts.unshift({
    id:Date.now(),
    username,
    text,
    likes:0,
    likedBy:[],
    comments:[],
    reactions:{ "‚ù§Ô∏è":0,"üî•":0,"üòÇ":0,"üòÆ":0 },
    created:new Date().toISOString()
  });

  postText.value='';
  savePosts();
  renderPosts();
});

// PROFILE UPDATE
function updateProfile(){
  document.getElementById('profilePosts').innerHTML='';
  renderPosts(document.getElementById('profilePosts'),true);
}

// START
if(username){
  renderPosts();
}
</script>
