<!DOCTYPE html>
<html lang="uk">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>FANTASYAS</title>
<link href="https://fonts.googleapis.com/css2?family=Manrope:wght@500;600;700;800&display=swap" rel="stylesheet"/>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
<style>
/* –¢–≤—ñ–π –ø–æ–ø–µ—Ä–µ–¥–Ω—ñ–π —Å—Ç–∏–ª—å –±–µ–∑ –∑–º—ñ–Ω ‚Äî —è –π–æ–≥–æ –Ω–µ —á—ñ–ø–∞—é */
*{margin:0;padding:0;box-sizing:border-box;font-family:'Manrope',sans-serif;}
body{background:#000;color:#fff;min-height:100vh;transition:0.4s;}
body.light{background:#fff;color:#111;}
.top-bar{position:fixed;top:0;left:0;right:0;height:70px;display:flex;align-items:center;justify-content:space-between;padding:0 20px;background:rgba(0,0,0,0.6);backdrop-filter:blur(6px);z-index:1000;transition:0.3s;}
body.light .top-bar{background:rgba(255,255,255,0.9);}
.site-name{font-size:1.7rem;font-weight:800;background:linear-gradient(90deg,#fff,#aaa);-webkit-background-clip:text;-webkit-text-fill-color:transparent;transition:0.3s;}
body.light .site-name{background:linear-gradient(90deg,#000,#444);}
.burger{width:30px;height:22px;display:flex;flex-direction:column;justify-content:space-between;cursor:pointer;transition:0.3s;}
.burger span{height:3px;width:100%;background:#fff;border-radius:3px;transition:0.4s;}
body.light .burger span{background:#000;}
.burger.active span:nth-child(1){transform:rotate(45deg) translate(5px,5px);}
.burger.active span:nth-child(2){opacity:0;}
.burger.active span:nth-child(3){transform:rotate(-45deg) translate(6px,-6px);}
.sidebar{position: fixed;top:0;left:-280px;width:280px;height:100%;background: rgba(0,0,0,0.4);backdrop-filter: blur(10px);padding:100px 30px;border-right:1px solid rgba(255,255,255,0.1);transition:0.4s;z-index:900;}
body.light .sidebar{background: rgba(255,255,255,0.4);backdrop-filter: blur(10px);border-right:1px solid rgba(0,0,0,0.08);}
.sidebar.active{left:0;}
.sidebar a{display:block;color:#aaa;text-decoration:none;font-size:1.2rem;font-weight:600;margin:1.2rem 0;transition:0.3s;}
body.light .sidebar a{color:#555;}
.sidebar a:hover{color:#fff;transform:translateX(6px);}
body.light .sidebar a:hover{color:#000;}
.main-content{margin-top:80px;padding:20px;}
.section{display:none;opacity:0;transform:translateY(10px);transition:0.3s;}
.section.active{display:block;opacity:1;transform:translateY(0);}
.auth-box{display:flex;flex-direction:column;gap:12px;background:rgba(255,255,255,0.05);padding:20px;border-radius:16px;max-width:400px;margin:auto;margin-top:60px;transition:0.3s;}
body.light .auth-box{background:rgba(0,0,0,0.03);}
.auth-box input{padding:10px;border-radius:10px;border:1px solid rgba(255,255,255,0.15);background:rgba(255,255,255,0.08);color:#fff;outline:none;}
body.light .auth-box input{background:#fff;color:#000;border:1px solid #ddd;}
.auth-box button{padding:10px 18px;border:none;border-radius:10px;cursor:pointer;font-weight:700;transition:0.2s, transform 0.2s;background:#444;color:#fff;}
.auth-box button:hover{transform:scale(1.05);opacity:0.9;}
.feed{display:flex;flex-direction:column;gap:16px;transition:0.3s;}
.post{background:rgba(255,255,255,0.05);border-radius:12px;padding:16px;border:1px solid rgba(255,255,255,0.1);opacity:0;transform:translateY(20px);transition:0.4s;}
.post.show{opacity:1;transform:translateY(0);}
body.light .post{background:rgba(0,0,0,0.03);}
.post-header{display:flex;align-items:center;gap:12px;margin-bottom:10px;}
.avatar{width:45px;height:45px;border-radius:50%;background:#444;background-size:cover;background-position:center;}
body.light .avatar{background:#ccc;}
.username{font-weight:700;}
.post-content{margin-bottom:8px;}
.profile-avatar{width:100px;height:100px;border-radius:50%;background:#333;background-size:cover;margin-bottom:10px;}
body.light .profile-avatar{background:#ddd;}
.profile-edit-form{display:flex;flex-direction:column;gap:12px;}
.profile-stats{display:flex;gap:15px;margin-top:8px;font-weight:600;}
.follow-btn{margin-top:10px;padding:8px 14px;border-radius:10px;font-weight:700;background:#555;color:#fff;cursor:pointer;transition:0.3s;}
.follow-btn.following{background:#0a84ff;color:#fff;transform:scale(1.05);}
.follow-btn:hover{opacity:0.9;}
.modal{position:fixed;inset:0;background:rgba(0,0,0,0.7);display:none;align-items:center;justify-content:center;z-index:2000;transition:0.3s;}
.modal.active{display:flex;}
.modal-content{background:#111;width:90%;max-width:500px;border-radius:16px;padding:24px;position:relative;border:1px solid rgba(255,255,255,0.15);}
body.light .modal-content{background:#fff;color:#000;}
.close-modal{position:absolute;top:12px;right:16px;font-size:1.8rem;cursor:pointer;color:#aaa;}
body.light .close-modal{color:#555;}
.post-actions{display:flex;align-items:center;gap:12px;margin-top:12px;}
.like-btn,.comment-btn,.add-comment{padding:8px 14px;background:rgba(255,255,255,0.1);border:none;border-radius:10px;cursor:pointer;color:#fff;font-weight:600;transition:0.2s;}
.like-btn:hover,.comment-btn:hover,.add-comment:hover{background:rgba(255,255,255,0.2);}
body.light .like-btn, body.light .comment-btn, body.light .add-comment{background:rgba(0,0,0,0.05);color:#000;}
body.light .like-btn:hover, body.light .comment-btn:hover, body.light .add-comment:hover{background:rgba(0,0,0,0.1);}
.comment{padding:10px;background:rgba(255,255,255,0.05);border-radius:8px;margin-top:6px;}
body.light .comment{background:rgba(0,0,0,0.03);}
.comment-username{font-weight:700;}
.chats{display:flex;flex-direction:column;gap:12px;}
.chat-item{padding:12px;background:rgba(255,255,255,0.05);border-radius:10px;cursor:pointer;transition:0.3s;}
.chat-item:hover{background:rgba(255,255,255,0.1);}
body.light .chat-item{background:rgba(0,0,0,0.03);}
body.light .chat-item:hover{background:rgba(0,0,0,0.06);}
.message{padding:8px;margin-top:6px;border-radius:8px;background:rgba(255,255,255,0.05);}
body.light .message{background:rgba(0,0,0,0.03);}

@media(max-width:900px){.sidebar{width:100%;left:-100%;border-right:none;}}
</style>
</head>
<body>

<div class="top-bar">
  <div class="burger" id="burger"><span></span><span></span><span></span></div>
  <div class="site-name">FANTASYAS</div>
</div>

<nav class="sidebar" id="sidebar">
  <a data-section="home">–ì–æ–ª–æ–≤–Ω–∞</a>
  <a data-section="profile">–ü—Ä–æ—Ñ—ñ–ª—å</a>
  <a data-section="messages">–ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è</a>
  <a data-section="groups">–ì—Ä—É–ø–∏</a>
  <a data-section="settings">–ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è</a>
</nav>

<main class="main-content">

  <!-- –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—è / –í—Ö—ñ–¥ –∑–∞ username -->
  <div id="home" class="section active">
    <div class="auth-box" id="authBox">
      <input type="text" id="usernameInput" placeholder="–í–≤–µ–¥–∏ —Å–≤—ñ–π –Ω—ñ–∫–Ω–µ–π–º">
      <button id="enterBtn">–£–≤—ñ–π—Ç–∏ / –ü–æ—á–∞—Ç–∏</button>
      <p id="authMessage" style="color:#ff6b6b; margin-top:8px; font-size:0.9rem;"></p>
    </div>

    <div class="new-post" id="newPostBox" style="display:none; flex-direction:column; gap:12px; max-width:600px; margin:20px auto;">
      <textarea id="postText" placeholder="–©–æ —É —Ç–µ–±–µ –Ω–∞ –¥—É–º—Ü—ñ?..." rows="4"></textarea>
      <input type="file" id="postImage" accept="image/*"/>
      <button id="addPost">–û–ø—É–±–ª—ñ–∫—É–≤–∞—Ç–∏</button>
    </div>

    <div class="feed" id="feed"></div>
  </div>

  <!-- –ü—Ä–æ—Ñ—ñ–ª—å (–∑–∞–ª–∏—à–∏–≤ –±–µ–∑ –∑–º—ñ–Ω, —Ç—ñ–ª—å–∫–∏ –∞–¥–∞–ø—Ç—É–≤–∞–≤ –ø—ñ–¥ username) -->
  <div id="profile" class="section">
    <div class="profile-header">
      <div class="profile-avatar" id="profileAvatar"></div>
      <div>
        <h2 id="profileUsernameDisplay"></h2>
        <p id="profileBio">–ù–µ–º–∞—î –æ–ø–∏—Å—É</p>
        <div class="profile-stats">
          <span id="postsCount">–ü–æ—Å—Ç–∏: 0</span>
          <span id="followersCount">–ü—ñ–¥–ø–∏—Å–Ω–∏–∫–∏: 0</span>
          <span id="followingCount">–ü—ñ–¥–ø–∏—Å–∫–∏: 0</span>
        </div>
        <button id="followBtn" class="follow-btn" style="display:none;">–ü—ñ–¥–ø–∏—Å–∞—Ç–∏—Å—è</button>
      </div>
      <button id="editProfileBtn">–†–µ–¥–∞–≥—É–≤–∞—Ç–∏ –ø—Ä–æ—Ñ—ñ–ª—å</button>
    </div>
  </div>

  <!-- –ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è, –≥—Ä—É–ø–∏, –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è ‚Äî –±–µ–∑ –∑–º—ñ–Ω -->
  <div id="messages" class="section"><h2>–ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è</h2><div id="chatList"></div></div>
  <div id="groups" class="section"><h2>–ì—Ä—É–ø–∏</h2></div>
  <div id="settings" class="section"><h2>–ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è</h2><button id="toggleTheme">–°–≤—ñ—Ç–ª–∞/–¢–µ–º–Ω–∞ —Ç–µ–º–∞</button></div>
</main>

<!-- –ú–æ–¥–∞–ª–∫–∞ —Ä–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è –ø—Ä–æ—Ñ—ñ–ª—é (–±–µ–∑ –∑–º—ñ–Ω) -->
<div class="modal" id="editProfileModal">
  <div class="modal-content">
    <span class="close-modal" id="closeModal">√ó</span>
    <h2>–†–µ–¥–∞–≥—É–≤–∞—Ç–∏ –ø—Ä–æ—Ñ—ñ–ª—å</h2>
    <div class="profile-edit-form">
      <input type="file" id="editAvatarFile"/>
      <textarea id="editBio" rows="4" placeholder="–û–ø–∏—Å –ø—Ä–æ—Ñ—ñ–ª—é..."></textarea>
      <button id="saveProfileEdit">–ó–±–µ—Ä–µ–≥—Ç–∏</button>
    </div>
  </div>
</div>

<script>
// Firebase –∫–æ–Ω—Ñ—ñ–≥ (–∑–∞–º—ñ–Ω–∏ –Ω–∞ —Å–≤—ñ–π)
const firebaseConfig = {
  apiKey: "–í–ê–®_API_KEY",
  authDomain: "–í–ê–®_PROJECT.firebaseapp.com",
  databaseURL: "https://–í–ê–®_PROJECT.firebaseio.com",
  projectId: "–í–ê–®_PROJECT",
  storageBucket: "–í–ê–®_PROJECT.appspot.com",
  messagingSenderId: "–í–ê–®_ID",
  appId: "–í–ê–®_APPID"
};
firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.database();

// –ó–º—ñ–Ω–Ω—ñ
let currentUser = null;
let userData = { username: '', avatar: '', bio: '', followers: [], following: [] };

// –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∏–π –≤—Ö—ñ–¥ –ø—Ä–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—ñ
auth.onAuthStateChanged(user => {
  if (user) {
    currentUser = user;
    afterLogin();
  } else {
    // –Ø–∫—â–æ –Ω–µ–º–∞—î –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ ‚Äî –ø–æ–∫–∞–∑—É—î–º–æ —Ñ–æ—Ä–º—É
    document.getElementById('authBox').style.display = 'flex';
    document.getElementById('newPostBox').style.display = 'none';
  }
});

// –ö–Ω–æ–ø–∫–∞ "–£–≤—ñ–π—Ç–∏ / –ü–æ—á–∞—Ç–∏"
document.getElementById('enterBtn').addEventListener('click', () => {
  const username = document.getElementById('usernameInput').value.trim();
  const msgEl = document.getElementById('authMessage');

  if (!username) {
    msgEl.textContent = '–í–≤–µ–¥–∏ –Ω—ñ–∫–Ω–µ–π–º!';
    return;
  }

  msgEl.textContent = '–ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ...';

  // –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ —á–∏ username –∑–∞–π–Ω—è—Ç–∏–π
  db.ref(`usernames/${username}`).once('value').then(snap => {
    const existingUid = snap.val();

    if (existingUid) {
      // Username –≤–∂–µ —î ‚Äî –ø–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ —á–∏ —Ü–µ –Ω–∞—à –∞–Ω–æ–Ω—ñ–º–Ω–∏–π –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á
      if (currentUser && existingUid === currentUser.uid) {
        afterLogin();
      } else {
        msgEl.textContent = '–¢–∞–∫–∏–π –Ω—ñ–∫–Ω–µ–π–º –≤–∂–µ –∑–∞–π–Ω—è—Ç–∏–π üòî';
      }
      return;
    }

    // Username –≤—ñ–ª—å–Ω–∏–π ‚Üí —Å—Ç–≤–æ—Ä—é—î–º–æ –∞–Ω–æ–Ω—ñ–º–Ω–∏–π –∞–∫–∞—É–Ω—Ç —ñ –ø—Ä–∏–≤'—è–∑—É—î–º–æ username
    if (!currentUser) {
      auth.signInAnonymously()
        .then(cred => {
          currentUser = cred.user;
          // –ó–∞–ø–∏—Å—É—î–º–æ username
          db.ref(`users/${currentUser.uid}`).set({
            username: username,
            avatar: '',
            bio: '',
            followers: [],
            following: []
          });
          db.ref(`usernames/${username}`).set(currentUser.uid);
          afterLogin();
        })
        .catch(err => {
          msgEl.textContent = '–ü–æ–º–∏–ª–∫–∞: ' + err.message;
        });
    } else {
      // –í–∂–µ —î –∞–Ω–æ–Ω—ñ–º–Ω–∏–π –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á, –∞–ª–µ —Ö–æ—á–µ –∑–º—ñ–Ω–∏—Ç–∏/–≤—Å—Ç–∞–Ω–æ–≤–∏—Ç–∏ username
      db.ref(`users/${currentUser.uid}`).update({ username });
      db.ref(`usernames/${username}`).set(currentUser.uid);
      afterLogin();
    }
  });
});

function afterLogin() {
  document.getElementById('authBox').style.display = 'none';
  document.getElementById('newPostBox').style.display = 'flex';
  document.getElementById('authMessage').textContent = '';

  // –ó–∞–≤–∞–Ω—Ç–∞–∂—É—î–º–æ –¥–∞–Ω—ñ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞
  db.ref(`users/${currentUser.uid}`).on('value', snap => {
    userData = snap.val() || { username: '–ì—ñ—Å—Ç—å', avatar: '', bio: '', followers: [], following: [] };
    document.getElementById('profileUsernameDisplay').textContent = userData.username;
    document.getElementById('profileAvatar').style.backgroundImage = `url('${userData.avatar}')`;
    document.getElementById('profileBio').textContent = userData.bio || '–ù–µ–º–∞—î –æ–ø–∏—Å—É';
  });

  // –ü–æ–∫–∞–∑—É—î–º–æ –ø—Ä–æ—Ñ—ñ–ª—å –ø–æ—Ç–æ—á–Ω–æ–≥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º
  showProfile(currentUser.uid);
}

// –ü–æ–∫–∞–∑ –ø—Ä–æ—Ñ—ñ–ª—é (–∞–¥–∞–ø—Ç–æ–≤–∞–Ω–æ –ø—ñ–¥ username)
function showProfile(uid) {
  if (uid === currentUser.uid) {
    document.getElementById('editProfileBtn').style.display = 'block';
    document.getElementById('followBtn').style.display = 'none';
  } else {
    document.getElementById('editProfileBtn').style.display = 'none';
    document.getElementById('followBtn').style.display = 'block';
    // ... —Ä–µ—à—Ç–∞ –ª–æ–≥—ñ–∫–∏ –ø—ñ–¥–ø–∏—Å–∫–∏ (–º–æ–∂–Ω–∞ –∑–∞–ª–∏—à–∏—Ç–∏ –∑ –ø–æ–ø–µ—Ä–µ–¥–Ω—å–æ—ó –≤–µ—Ä—Å—ñ—ó)
  }
}

// –ù–æ–≤–∏–π –ø–æ—Å—Ç (–∑–º—ñ–Ω–µ–Ω–æ username ‚Üí userData.username)
document.getElementById('addPost').addEventListener('click', () => {
  const text = document.getElementById('postText').value.trim();
  if (!text) return;

  const file = document.getElementById('postImage').files[0];
  const postData = {
    uid: currentUser.uid,
    username: userData.username,
    avatar: userData.avatar,
    text,
    image: null,
    time: Date.now(),
    likes: [],
    comments: {}
  };

  if (file) {
    const reader = new FileReader();
    reader.onload = e => {
      postData.image = e.target.result;
      db.ref('posts').push(postData);
      document.getElementById('postText').value = '';
      document.getElementById('postImage').value = '';
    };
    reader.readAsDataURL(file);
  } else {
    db.ref('posts').push(postData);
    document.getElementById('postText').value = '';
  }
});

// –ü–æ—Å—Ç–∏ (–∑–º—ñ–Ω–µ–Ω–æ p.username)
const feed = document.getElementById('feed');
db.ref('posts').on('value', snap => {
  feed.innerHTML = '';
  const data = snap.val() || {};
  Object.entries(data)
    .sort((a, b) => b[1].time - a[1].time)
    .forEach(([key, p]) => {
      const div = document.createElement('div');
      div.className = 'post';
      div.innerHTML = `
        <div class="post-header">
          <div class="avatar" style="background-image:url('${p.avatar||''}')"></div>
          <div class="username" data-uid="${p.uid}">${p.username}</div>
        </div>
        <div class="post-content">${p.text}${p.image ? `<img src="${p.image}" style="max-width:100%;margin-top:8px;border-radius:8px;"/>` : ''}</div>
        <!-- —Ä–µ—à—Ç–∞: –ª–∞–π–∫–∏, –∫–æ–º–µ–Ω—Ç–∞—Ä—ñ ‚Äî —è–∫ –±—É–ª–æ -->
      `;
      feed.appendChild(div);
      setTimeout(() => div.classList.add('show'), 50);
    });
});

// –ë—É—Ä–≥–µ—Ä –º–µ–Ω—é, —Ç–µ–º–∏, —Ä–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è –ø—Ä–æ—Ñ—ñ–ª—é ‚Äî –±–µ–∑ –∑–º—ñ–Ω, –ø—Ä–æ—Å—Ç–æ —Å–∫–æ–ø—ñ—é–π –∑ –ø–æ–ø–µ—Ä–µ–¥–Ω—å–æ—ó –≤–µ—Ä—Å—ñ—ó

// ... (–≤—Å—Ç–∞–≤ —Å—é–¥–∏ —Ä–µ—à—Ç—É —Å–∫—Ä–∏–ø—Ç—É: –±—É—Ä–≥–µ—Ä, —Å–µ–∫—Ü—ñ—ó, —Ä–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è –∞–≤–∞—Ç–∞—Ä–∫–∏/–±—ñ–æ, –ª–∞–π–∫–∏, –∫–æ–º–µ–Ω—Ç–∞—Ä—ñ, —á–∞—Ç–∏ —Ç–æ—â–æ)

</script>
</body>
</html>
