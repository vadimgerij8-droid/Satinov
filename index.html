<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>FANTASYAS</title>

  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"/>
  <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@400;500;600;700&display=swap" rel="stylesheet"/>

  <style>
    :root {
      --bg: #0a0a0f;
      --surface: rgba(25, 25, 35, 0.55);
      --surface-alt: rgba(35, 35, 50, 0.65);
      --text: #e8e8f0;
      --text-secondary: #b0b0c8;
      --accent: #5288c1;
      --accent-light: #60a0e0;
      --border: rgba(120, 140, 180, 0.22);
      --blur: blur(16px);
      --radius: 18px;
      --shadow: 0 8px 32px rgba(0,0,0,0.45);
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Manrope', system-ui, sans-serif;
      background: var(--bg);
      color: var(--text);
      min-height: 100vh;
      line-height: 1.5;
    }

    /* ‚îÄ‚îÄ‚îÄ Header ‚îÄ‚îÄ‚îÄ */
    header {
      position: fixed;
      top: 0; left: 0; right: 0;
      height: 60px;
      background: var(--surface);
      backdrop-filter: var(--blur);
      -webkit-backdrop-filter: var(--blur);
      border-bottom: 1px solid var(--border);
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 16px;
      z-index: 1000;
    }

    .burger {
      font-size: 1.4rem;
      color: var(--text-secondary);
      cursor: pointer;
      padding: 8px;
    }

    h1 {
      font-size: 1.3rem;
      font-weight: 600;
      letter-spacing: -0.3px;
    }

    /* ‚îÄ‚îÄ‚îÄ Sidebar ‚îÄ‚îÄ‚îÄ */
    .sidebar {
      position: fixed;
      top: 0; left: -280px;
      width: 280px;
      height: 100%;
      background: var(--surface);
      backdrop-filter: var(--blur);
      border-right: 1px solid var(--border);
      transition: left 0.35s ease;
      z-index: 999;
      padding-top: 70px;
    }

    .sidebar.active { left: 0; }

    .sidebar nav {
      display: flex;
      flex-direction: column;
      padding: 12px;
    }

    .sidebar button {
      width: 100%;
      padding: 14px 16px;
      background: transparent;
      border: none;
      color: var(--text-secondary);
      font-size: 1.05rem;
      text-align: left;
      border-radius: 12px;
      cursor: pointer;
      transition: all 0.25s;
    }

    .sidebar button:hover,
    .sidebar button.active {
      background: var(--surface-alt);
      color: var(--text);
    }

    /* ‚îÄ‚îÄ‚îÄ Main ‚îÄ‚îÄ‚îÄ */
    main {
      padding: 76px 16px 90px;
      max-width: 720px;
      margin: 0 auto;
    }

    .section { display: none; }
    .section.active { display: block; }

    /* ‚îÄ‚îÄ‚îÄ Input area (—è–∫ —É Telegram) ‚îÄ‚îÄ‚îÄ */
    .composer {
      background: var(--surface);
      backdrop-filter: var(--blur);
      border-radius: var(--radius);
      padding: 12px 16px;
      margin-bottom: 20px;
      border: 1px solid var(--border);
    }

    textarea {
      width: 100%;
      min-height: 48px;
      background: transparent;
      border: none;
      color: var(--text);
      font-size: 1.05rem;
      resize: none;
      outline: none;
    }

    .composer-actions {
      display: flex;
      justify-content: space-between;
      margin-top: 8px;
    }

    .btn {
      background: var(--accent);
      color: white;
      border: none;
      border-radius: 12px;
      padding: 8px 18px;
      font-weight: 500;
      cursor: pointer;
      transition: background 0.2s;
    }

    .btn:hover { background: var(--accent-light); }

    .btn-icon {
      background: transparent;
      color: var(--text-secondary);
      font-size: 1.3rem;
      border: none;
      cursor: pointer;
      padding: 6px;
    }

    /* ‚îÄ‚îÄ‚îÄ Message / Post ‚îÄ‚îÄ‚îÄ */
    .message {
      display: flex;
      margin: 12px 0;
      max-width: 80%;
    }

    .message.own {
      margin-left: auto;
      flex-direction: row-reverse;
    }

    .bubble {
      background: var(--surface-alt);
      backdrop-filter: var(--blur);
      border-radius: 18px;
      padding: 10px 14px;
      border: 1px solid var(--border);
      position: relative;
    }

    .bubble.own {
      background: var(--accent);
      color: white;
      border-color: transparent;
    }

    .bubble .text {
      word-break: break-word;
    }

    .bubble .time {
      font-size: 0.78rem;
      opacity: 0.7;
      margin-top: 4px;
      text-align: right;
    }

    .media-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
      gap: 6px;
      margin: 8px 0;
    }

    .media-item {
      border-radius: 12px;
      overflow: hidden;
      cursor: pointer;
    }

    .media-item img, .media-item video {
      width: 100%;
      display: block;
    }

    /* ‚îÄ‚îÄ‚îÄ Modal ‚îÄ‚îÄ‚îÄ */
    .modal {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.9);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 2000;
    }

    .modal img, .modal video {
      max-width: 94%;
      max-height: 94vh;
      border-radius: 12px;
    }

    .close {
      position: absolute;
      top: 20px;
      right: 20px;
      font-size: 2.8rem;
      color: white;
      cursor: pointer;
    }

    /* ‚îÄ‚îÄ‚îÄ Emoji picker (–ø—Ä–æ—Å—Ç–∏–π) ‚îÄ‚îÄ‚îÄ */
    #emojiPicker {
      display: none;
      position: absolute;
      bottom: 80px;
      left: 16px;
      background: var(--surface);
      backdrop-filter: var(--blur);
      border: 1px solid var(--border);
      border-radius: 16px;
      padding: 12px;
      max-height: 200px;
      overflow-y: auto;
      box-shadow: var(--shadow);
    }

    #emojiPicker button {
      background: none;
      border: none;
      font-size: 1.8rem;
      margin: 4px;
      cursor: pointer;
    }
  </style>
</head>
<body>

<header>
  <div class="burger" onclick="toggleSidebar()"><i class="fa-solid fa-bars"></i></div>
  <h1>FANTASYAS</h1>
  <div></div> <!-- –º—ñ—Å—Ü–µ –¥–ª—è –º–∞–π–±—É—Ç–Ω—ñ—Ö —ñ–∫–æ–Ω–æ–∫ -->
</header>

<div class="sidebar" id="sidebar">
  <nav>
    <button onclick="showSection('feed')" class="active">–°—Ç—Ä—ñ—á–∫–∞</button>
    <button onclick="showSection('profile')">–ü—Ä–æ—Ñ—ñ–ª—å</button>
  </nav>
</div>

<main>

  <!-- ‚îÄ‚îÄ‚îÄ FEED / –ß–∞—Ç-—Å—Ç—Ä—ñ—á–∫–∞ ‚îÄ‚îÄ‚îÄ -->
  <section id="feed" class="section active">
    <div class="composer">
      <textarea id="postText" placeholder="–ù–∞–ø–∏—à–∏ —â–æ—Å—å..." rows="1"></textarea>
      <div class="composer-actions">
        <button class="btn-icon" onclick="toggleEmoji()"><i class="fa-regular fa-face-smile"></i></button>
        <input type="file" id="mediaInput" multiple accept="image/*,video/*" style="display:none"/>
        <button class="btn-icon" onclick="document.getElementById('mediaInput').click()">
          <i class="fa-regular fa-image"></i>
        </button>
        <button class="btn" onclick="addPost()">–í—ñ–¥–ø—Ä–∞–≤–∏—Ç–∏</button>
      </div>
      <div id="preview" class="media-grid"></div>
    </div>

    <div id="messages"></div>
  </section>

  <!-- ‚îÄ‚îÄ‚îÄ PROFILE ‚îÄ‚îÄ‚îÄ -->
  <section id="profile" class="section">
    <div class="composer" style="text-align:center;">
      <div style="width:120px;height:120px;border-radius:50%;overflow:hidden;margin:0 auto 16px;background:#222;border:2px solid var(--border)">
        <img id="avatarImg" style="width:100%;height:100%;object-fit:cover;" src="" alt="">
      </div>
      <input type="file" id="avatarInput" accept="image/*" style="margin:12px 0;"/>
      <textarea id="bio" placeholder="–ü—Ä–æ —Å–µ–±–µ..." maxlength="180"></textarea>
      <button class="btn" style="margin-top:12px;" onclick="saveProfile()">–ó–±–µ—Ä–µ–≥—Ç–∏</button>
    </div>

    <div id="profileMessages"></div>
  </section>

</main>

<div class="modal" id="modal">
  <span class="close" onclick="closeModal()">√ó</span>
  <img id="modalImg" alt="">
  <video id="modalVideo" controls style="display:none;"></video>
</div>

<div id="emojiPicker"></div>

<script>
const currentUser = '–í–∏';
let posts = JSON.parse(localStorage.getItem('fantasyPosts') || '[]');
let user = JSON.parse(localStorage.getItem('fantasyUser') || '{}');

function toggleSidebar() {
  document.getElementById('sidebar').classList.toggle('active');
}

function showSection(id) {
  document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
  document.getElementById(id).classList.add('active');

  document.querySelectorAll('.sidebar button').forEach(b => b.classList.remove('active'));
  event.target.classList.add('active');

  toggleSidebar(); // –∑–∞–∫—Ä–∏–≤–∞—î–º–æ —Å–∞–π–¥–±–∞—Ä
}

function addPost() {
  const text = document.getElementById('postText').value.trim();
  if (!text) return;

  const media = [];
  const files = document.getElementById('mediaInput').files;
  let loaded = 0;

  if (files.length === 0) {
    createPostObj(text, []);
    return;
  }

  Array.from(files).slice(0,4).forEach(file => {
    const r = new FileReader();
    r.onload = e => {
      media.push({type: file.type, url: e.target.result});
      loaded++;
      if (loaded === files.length) {
        createPostObj(text, media);
      }
    };
    r.readAsDataURL(file);
  });
}

function createPostObj(text, media) {
  const post = {
    id: Date.now(),
    text,
    author: currentUser,
    media,
    likes: 0,
    comments: [],
    timestamp: Date.now()
  };

  posts.unshift(post);
  save();
  renderFeed();
  document.getElementById('postText').value = '';
  document.getElementById('mediaInput').value = '';
  document.getElementById('preview').innerHTML = '';
}

function renderFeed() {
  const container = document.getElementById('messages');
  container.innerHTML = '';

  posts.forEach(p => {
    const isOwn = p.author === currentUser;
    const bubbleClass = isOwn ? 'bubble own' : 'bubble';

    let html = `
      <div class="message ${isOwn ? 'own' : ''}">
        <div class="${bubbleClass}">
          <div class="text">${p.text}</div>
          ${p.media.map(m => `
            <div class="media-grid">
              ${m.type.startsWith('image')
                ? `<img src="${m.url}" onclick="openModal('${m.url}', false)">`
                : `<video src="${m.url}" controls onclick="openModal('${m.url}', true)"></video>`}
            </div>
          `).join('')}
          <div class="time">${new Date(p.timestamp).toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'})}</div>
        </div>
      </div>
    `;

    container.innerHTML += html;
  });

  // –ø—Ä–æ—Ñ—ñ–ª—å–Ω—ñ –ø–æ—Å—Ç–∏
  document.getElementById('profileMessages').innerHTML = container.innerHTML;
}

function openModal(url, isVideo) {
  const modal = document.getElementById('modal');
  if (isVideo) {
    document.getElementById('modalImg').style.display = 'none';
    const vid = document.getElementById('modalVideo');
    vid.src = url;
    vid.style.display = 'block';
    vid.play();
  } else {
    document.getElementById('modalVideo').style.display = 'none';
    document.getElementById('modalImg').src = url;
    document.getElementById('modalImg').style.display = 'block';
  }
  modal.style.display = 'flex';
}

function closeModal() {
  const modal = document.getElementById('modal');
  modal.style.display = 'none';
  document.getElementById('modalVideo').pause();
}

function save() {
  localStorage.setItem('fantasyPosts', JSON.stringify(posts));
  localStorage.setItem('fantasyUser', JSON.stringify(user));
}

// ‚îÄ‚îÄ‚îÄ Profile ‚îÄ‚îÄ‚îÄ
function saveProfile() {
  user.bio = document.getElementById('bio').value;
  const file = document.getElementById('avatarInput').files[0];
  if (file) {
    const r = new FileReader();
    r.onload = e => {
      user.avatar = e.target.result;
      document.getElementById('avatarImg').src = user.avatar;
      save();
    };
    r.readAsDataURL(file);
  } else {
    save();
  }
}

// ‚îÄ‚îÄ‚îÄ Emoji (–¥—É–∂–µ –ø—Ä–æ—Å—Ç–∏–π) ‚îÄ‚îÄ‚îÄ
const emojis = 'üòÄ üòÇ ‚ù§Ô∏è üíú ‚ú® üî• üåô ü™ê ‚ö° üéÆ üé® üßô'.split(' ');

function toggleEmoji() {
  const picker = document.getElementById('emojiPicker');
  if (picker.style.display === 'block') {
    picker.style.display = 'none';
    return;
  }

  picker.innerHTML = emojis.map(e => `<button onclick="insertEmoji('${e}')">${e}</button>`).join('');
  picker.style.display = 'block';
}

function insertEmoji(e) {
  const ta = document.getElementById('postText');
  ta.value += e;
  ta.focus();
}

// ‚îÄ‚îÄ‚îÄ Preview –º–µ–¥—ñ–∞ ‚îÄ‚îÄ‚îÄ
document.getElementById('mediaInput').onchange = e => {
  const prev = document.getElementById('preview');
  prev.innerHTML = '';
  Array.from(e.target.files).slice(0,4).forEach(f => {
    const r = new FileReader();
    r.onload = ev => {
      const div = document.createElement('div');
      div.className = 'media-item';
      if (f.type.startsWith('image')) {
        div.innerHTML = `<img src="${ev.target.result}">`;
      } else {
        div.innerHTML = `<video src="${ev.target.result}" controls></video>`;
      }
      prev.appendChild(div);
    };
    r.readAsDataURL(f);
  });
};

// ‚îÄ‚îÄ‚îÄ Init ‚îÄ‚îÄ‚îÄ
if (user.avatar) document.getElementById('avatarImg').src = user.avatar;
document.getElementById('bio').value = user.bio || '';
renderFeed();

// –∫–ª—ñ–∫ –ø–æ–∑–∞ –µ–º–æ–¥–∑—ñ / –º–µ–Ω—é
document.addEventListener('click', e => {
  if (!e.target.closest('#emojiPicker') && !e.target.closest('.btn-icon[onclick*="toggleEmoji"]')) {
    document.getElementById('emojiPicker').style.display = 'none';
  }
});
</script>
</body>
</html>
