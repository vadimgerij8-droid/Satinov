<!DOCTYPE html>
<html lang="uk">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>FANTASYAS</title>

<link href="https://fonts.googleapis.com/css2?family=Manrope:wght@400;500;600;700;800&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">

<style>
:root {
  --bg: #000;
  --card: #111;
  --text: #fff;
  --muted: #aaa;
  --border: #333;
  --shadow: rgba(255,255,255,0.05);
}

* {margin:0;padding:0;box-sizing:border-box}
body {
  font-family: Manrope, sans-serif;
  background: var(--bg);
  color: var(--text);
  transition: background 0.4s ease, color 0.4s ease;
}

/* TOP */
.top {
  position:fixed;top:0;left:0;right:0;height:64px;
  display:flex;align-items:center;justify-content:space-between;
  padding:0 20px;
  background:rgba(20,20,20,.6);
  backdrop-filter:blur(20px);
  border-bottom:1px solid var(--border);
  z-index:1000;
}
.burger{cursor:pointer}
.burger i{font-size:1.4rem}

/* SIDEBAR */
.sidebar {
  position:fixed;top:0;left:-80px;width:80px;height:100%;
  background:rgba(20,20,20,.6);
  backdrop-filter:blur(20px);
  border-right:1px solid var(--border);
  padding-top:90px;
  display:flex;flex-direction:column;align-items:center;gap:16px;
  transition:.4s;
}
.sidebar.active{left:0}
.sidebar button {
  width:48px;height:48px;
  border-radius:14px;
  background:none;border:none;
  color:var(--muted);
  font-size:1.2rem;
  cursor:pointer;
  transition:all .3s ease;
}
.sidebar button.active,
.sidebar button:hover {
  background:var(--shadow);
  color:var(--text);
}

/* MAIN */
main {padding:90px 20px;max-width:900px;margin:auto}
.section{display:none}
.section.active{display:block}

/* CARD */
.card {
  background: var(--card);
  border-radius: 22px;
  padding: 18px;
  border: 1px solid var(--border);
  margin-bottom: 20px;
  box-shadow: 0 4px 12px var(--shadow);
  opacity: 0;
  transform: translateY(20px) scale(0.98);
  animation: fadeInUp 0.6s forwards ease-out;
}
@keyframes fadeInUp {
  to {opacity:1;transform:translateY(0) scale(1);}
}

/* PROFILE */
.profile-head {
  display:flex;flex-direction:column;align-items:center;gap:16px;text-align:center;
  margin-bottom:24px;
}
.avatar {
  width:120px;height:120px;border-radius:50%;
  background:#333;
  overflow:hidden;
  display:flex;align-items:center;justify-content:center;
  border:2px solid var(--border);
  transition:transform 0.3s;
}
.avatar:hover{transform:scale(1.05)}
.avatar img{width:100%;height:100%;object-fit:cover}
input,textarea {
  width:100%;
  background:var(--bg);
  border:1px solid var(--border);
  border-radius:14px;
  padding:12px;
  color:var(--text);
  resize:none;
  transition:border 0.3s;
}
input:focus,textarea:focus{border-color:var(--muted)}
button {
  background:var(--bg);
  border:1px solid var(--border);
  border-radius:12px;
  padding:12px 16px;
  color:var(--text);
  cursor:pointer;
  transition:all 0.3s ease;
  font-size:1rem;
}
button:hover {
  background:var(--card);
  box-shadow:0 2px 8px var(--shadow);
}

/* POST */
.post-header {
  display:flex;justify-content:space-between;align-items:center;
  margin-bottom:12px;
}
.menu{position:relative}
.menu-box {
  position:absolute;right:0;top:24px;
  background:rgba(20,20,20,.9);
  border:1px solid var(--border);
  border-radius:12px;
  display:none;
  flex-direction:column;
  box-shadow:0 4px 12px var(--shadow);
}
.menu-box button{text-align:left;padding:8px 16px;border:none;background:none;transition:background 0.3s}
.menu-box button:hover{background:var(--shadow)}

/* MEDIA */
.media-grid {
  display:grid;grid-template-columns:repeat(auto-fit,minmax(100px,1fr));gap:8px;
  margin:12px 0;
}
.media-item {
  position:relative;
  border-radius:12px;overflow:hidden;
  cursor:pointer;
  transition:transform 0.3s;
}
.media-item:hover{transform:scale(1.02)}
.media-item img,.media-item video{width:100%;height:auto;display:block}

/* COMMENTS */
.comment {
  margin-top:8px;
  padding-left:12px;
  border-left:2px solid var(--border);
  font-size:.9rem;
}

/* MODAL FULLSCREEN */
.modal {
  display:none;
  position:fixed;top:0;left:0;width:100%;height:100%;
  background:rgba(0,0,0,.9);
  align-items:center;justify-content:center;
  z-index:2000;
}
.modal-content{max-width:90%;max-height:90%;object-fit:contain}
.close-modal{position:absolute;top:20px;right:20px;color:#fff;font-size:2rem;cursor:pointer}

/* EMOJI PICKER */
.emoji-picker{display:none;position:absolute;bottom:50px;left:0;background:var(--card);border:1px solid var(--border);border-radius:12px;padding:8px;overflow:auto;max-height:200px;}
.emoji-picker button{background:none;border:none;font-size:1.5rem;cursor:pointer;margin:4px;transition:transform 0.3s}
.emoji-picker button:hover{transform:scale(1.2)}
</style>
</head>

<body>

<div class="top">
  <div class="burger" onclick="toggleSidebar()"><i class="fa-solid fa-bars"></i></div>
  <b>FANTASYAS</b>
  <button id="themeToggle"><i class="fa-solid fa-moon"></i></button>
</div>

<div class="sidebar" id="sidebar">
  <button onclick="openSection('feed')" class="active"><i class="fa-solid fa-house"></i></button>
  <button onclick="openSection('profile')"><i class="fa-solid fa-user"></i></button>
</div>

<main>

<!-- FEED -->
<section id="feed" class="section active">
  <div class="card">
    <div style="position:relative;">
      <textarea id="postText" maxlength="500" placeholder="–©–æ –Ω–æ–≤–æ–≥–æ?"></textarea>
      <div id="charCount" style="position:absolute;bottom:8px;right:12px;font-size:0.8rem;color:var(--muted);">0/500</div>
      <button onclick="toggleEmojiPicker('postText')" style="position:absolute;bottom:12px;left:12px;background:none;border:none;color:var(--muted);"><i class="fa-solid fa-face-smile"></i></button>
    </div>
    <div id="previewMedia" class="media-grid"></div>
    <input type="file" id="mediaInput" multiple accept="image/*,video/*">
    <button onclick="addPost()">–û–ø—É–±–ª—ñ–∫—É–≤–∞—Ç–∏</button>
  </div>
  <div style="margin-bottom:16px;display:flex;gap:8px;">
    <select id="sortFeed">
      <option value="new">–ù–æ–≤—ñ—à—ñ</option>
      <option value="old">–°—Ç–∞—Ä—ñ—à—ñ</option>
      <option value="popular">–ü–æ–ø—É–ª—è—Ä–Ω—ñ (–ª–∞–π–∫–∏)</option>
    </select>
    <button onclick="render()">–û–Ω–æ–≤–∏—Ç–∏</button>
  </div>
  <div id="feedPosts"></div>
</section>

<!-- PROFILE -->
<section id="profile" class="section">
  <div class="card profile-head">
    <div class="avatar" id="avatar"></div>
    <textarea id="bio" placeholder="–ü—Ä–æ —Å–µ–±–µ" maxlength="200"></textarea>
    <input type="file" id="avatarInput" accept="image/*">
    <button onclick="saveProfile()">–ó–±–µ—Ä–µ–≥—Ç–∏ –ø—Ä–æ—Ñ—ñ–ª—å</button>
  </div>

  <div class="card">
    <h3>–î–æ–¥–∞—Ç–∏ —Ñ–æ—Ç–æ/–≤—ñ–¥–µ–æ –¥–æ –≥–∞–ª–µ—Ä–µ—ó</h3>
    <input type="file" id="profileMediaInput" multiple accept="image/*,video/*">
    <button onclick="addProfileMedia()">–î–æ–¥–∞—Ç–∏</button>
    <div id="profileGallery" class="media-grid"></div>
  </div>

  <div id="profilePosts"></div>
</section>

</main>

<!-- MODAL -->
<div class="modal" id="modal" onclick="closeModal()">
  <span class="close-modal" onclick="closeModal()">&times;</span>
  <img id="modalContent" class="modal-content">
</div>

<!-- EMOJI PICKER -->
<div id="emojiPicker" class="emoji-picker"></div>

<script>
const currentUser = 'you';
let user = { avatar: null, bio: '', gallery: [] };
let posts = [];
let draft = '';
const emojiList = ['üòÄ','üòÇ','‚ù§Ô∏è','üëç','üî•','üòé','ü§î','üéâ','üåü','üöÄ']; // –º–æ–∂–Ω–∞ –¥–æ–¥–∞—Ç–∏ –±—ñ–ª—å—à–µ

function toggleSidebar() {
  sidebar.classList.toggle('active');
}

function openSection(id) {
  document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
  document.getElementById(id).classList.add('active');
  document.querySelectorAll('.sidebar button').forEach(b => b.classList.remove('active'));
  event.target.closest('button').classList.add('active');
  sidebar.classList.remove('active');
}

function setTheme(isDark) {
  if (isDark) {
    document.documentElement.style.setProperty('--bg', '#000');
    document.documentElement.style.setProperty('--card', '#111');
    document.documentElement.style.setProperty('--text', '#fff');
    document.documentElement.style.setProperty('--muted', '#aaa');
    document.documentElement.style.setProperty('--border', '#333');
    document.documentElement.style.setProperty('--shadow', 'rgba(255,255,255,0.05)');
    themeToggle.innerHTML = '<i class="fa-solid fa-sun"></i>';
  } else {
    document.documentElement.style.setProperty('--bg', '#fff');
    document.documentElement.style.setProperty('--card', '#eee');
    document.documentElement.style.setProperty('--text', '#000');
    document.documentElement.style.setProperty('--muted', '#666');
    document.documentElement.style.setProperty('--border', '#ccc');
    document.documentElement.style.setProperty('--shadow', 'rgba(0,0,0,0.05)');
    themeToggle.innerHTML = '<i class="fa-solid fa-moon"></i>';
  }
  localStorage.setItem('theme', isDark ? 'dark' : 'light');
}

themeToggle.onclick = () => {
  const current = localStorage.getItem('theme') !== 'light';
  setTheme(!current);
};

const savedTheme = localStorage.getItem('theme');
setTheme(savedTheme !== 'light');

function loadData() {
  const savedPosts = localStorage.getItem('posts');
  if (savedPosts) posts = JSON.parse(savedPosts);
  const savedUser = localStorage.getItem('user');
  if (savedUser) user = JSON.parse(savedUser);
  draft = localStorage.getItem('draft') || '';
  postText.value = draft;
  render();
}

function saveData() {
  localStorage.setItem('posts', JSON.stringify(posts));
  localStorage.setItem('user', JSON.stringify(user));
}

loadData();

postText.oninput = () => {
  document.getElementById('charCount').textContent = `${postText.value.length}/500`;
  draft = postText.value;
  localStorage.setItem('draft', draft);
};

setInterval(() => {
  if (postText.value !== draft) {
    draft = postText.value;
    localStorage.setItem('draft', draft);
  }
}, 5000);

mediaInput.onchange = () => {
  previewMedia.innerHTML = '';
  Array.from(mediaInput.files).slice(0,4).forEach(file => {
    const reader = new FileReader();
    reader.onload = e => {
      const div = document.createElement('div');
      div.className = 'media-item';
      if (file.type.startsWith('image')) {
        div.innerHTML = `<img src="${e.target.result}">`;
      } else {
        div.innerHTML = `<video src="${e.target.result}" controls></video>`;
      }
      previewMedia.appendChild(div);
    };
    reader.readAsDataURL(file);
  });
};

function addPost(isEdit = false, editIndex = -1) {
  const t = postText.value.trim();
  if (!t) return;
  const media = [];
  Array.from(mediaInput.files).forEach(file => {
    const reader = new FileReader();
    reader.onload = e => media.push({type: file.type, url: e.target.result});
    reader.readAsDataURL(file);
  });
  const post = { text: t, author: currentUser, likes: 0, likedBy: [], comments: [], media: media, timestamp: Date.now() };
  if (isEdit) {
    posts[editIndex] = post;
  } else {
    posts.unshift(post);
  }
  postText.value = '';
  mediaInput.value = '';
  previewMedia.innerHTML = '';
  localStorage.removeItem('draft');
  saveData();
  render();
}

function editPost(i) {
  postText.value = posts[i].text;
  // –î–ª—è –º–µ–¥—ñ–∞ - –º–æ–∂–Ω–∞ –¥–æ–¥–∞—Ç–∏ preview, –∞–ª–µ –¥–ª—è –ø—Ä–æ—Å—Ç–æ—Ç–∏ –ø—Ä–æ–ø—É—Å—Ç–∏–º–æ —Ä–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è –º–µ–¥—ñ–∞
  const editBtn = document.createElement('button');
  editBtn.textContent = '–ó–±–µ—Ä–µ–≥—Ç–∏ –∑–º—ñ–Ω–∏';
  editBtn.onclick = () => addPost(true, i);
  document.querySelector('#feed .card').appendChild(editBtn);
}

function addComment(i) {
  const input = document.getElementById('c-' + i);
  const t = input.value.trim();
  if (!t) return;
  posts[i].comments.push({ text: t, author: currentUser });
  input.value = '';
  saveData();
  render();
}

function toggleLike(i) {
  if (!posts[i].likedBy) posts[i].likedBy = [];
  const idx = posts[i].likedBy.indexOf(currentUser);
  if (idx === -1) {
    posts[i].likedBy.push(currentUser);
    posts[i].likes = (posts[i].likes || 0) + 1;
  } else {
    posts[i].likedBy.splice(idx, 1);
    posts[i].likes--;
  }
  saveData();
  render();
}

function repost(i) {
  const quote = prompt('–î–æ–¥–∞—Ç–∏ –∫–æ–º–µ–Ω—Ç–∞—Ä –¥–æ —Ä–µ–ø–æ—Å—Ç—É?');
  const repost = { text: quote || '', author: currentUser, likes: 0, likedBy: [], comments: [], media: [], timestamp: Date.now(), quoteFrom: i };
  posts.unshift(repost);
  saveData();
  render();
}

function toggleMenu(id) {
  document.querySelectorAll('.menu-box').forEach(m => m.style.display = 'none');
  const menu = document.getElementById(id);
  menu.style.display = menu.style.display === 'flex' ? 'none' : 'flex';
}

function deletePost(i) {
  posts.splice(i, 1);
  saveData();
  render();
}

function sortPosts() {
  const sort = document.getElementById('sortFeed').value;
  if (sort === 'new') {
    posts.sort((a,b) => b.timestamp - a.timestamp);
  } else if (sort === 'old') {
    posts.sort((a,b) => a.timestamp - b.timestamp);
  } else if (sort === 'popular') {
    posts.sort((a,b) => (b.likes || 0) - (a.likes || 0));
  }
}

function render() {
  sortPosts();
  feedPosts.innerHTML = '';
  profilePosts.innerHTML = '';
  posts.forEach((p, i) => {
    let html = `
    <div class="card">
      <div class="post-header">
        <b>@${p.author}</b>
        ${p.author === currentUser ? `
        <div class="menu">
          <button onclick="toggleMenu('m-${i}')"><i class="fa-solid fa-ellipsis-vertical"></i></button>
          <div class="menu-box" id="m-${i}">
            <button onclick="editPost(${i})">–†–µ–¥–∞–≥—É–≤–∞—Ç–∏</button>
            <button onclick="deletePost(${i})">–í–∏–¥–∞–ª–∏—Ç–∏</button>
            <button onclick="repost(${i})">–†–µ–ø–æ—Å—Ç</button>
          </div>
        </div>` : ''}
      </div>
      ${p.quoteFrom !== undefined ? `<div class="comment" style="margin-bottom:12px;">–¶–∏—Ç–∞—Ç–∞ –∑ –ø–æ—Å—Ç—É @${posts[p.quoteFrom].author}: ${posts[p.quoteFrom].text}</div>` : ''}
      <p>${p.text}</p>
      ${p.media && p.media.length ? `<div class="media-grid">${p.media.map(m => m.type.startsWith('image') ? `<img class="media-item" src="${m.url}" onclick="openModal('${m.url}')">` : `<video class="media-item" src="${m.url}" controls onclick="openModal('${m.url}', true)"></video>`).join('')}</div>` : ''}
      <div style="display:flex;gap:16px;align-items:center;margin:12px 0;">
        <button onclick="toggleLike(${i})" style="background:none;border:none;color:${p.likedBy.includes(currentUser) ? 'var(--text)' : 'var(--muted)'}">
          <i class="fa-solid fa-heart${p.likedBy.includes(currentUser) ? '' : '-o'}"></i> ${p.likes || 0}
        </button>
        <button onclick="repost(${i})" style="background:none;border:none;color:var(--muted)"><i class="fa-solid fa-retweet"></i></button>
      </div>
      <div>
        ${p.comments.map(c => `<div class="comment">@${c.author}: ${c.text}</div>`).join('')}
        <div style="display:flex;gap:8px;margin-top:8px;">
          <input id="c-${i}" placeholder="–í—ñ–¥–ø–æ–≤—ñ—Å—Ç–∏">
          <button onclick="addComment(${i})">OK</button>
        </div>
      </div>
    </div>`;
    feedPosts.innerHTML += html;
    if (p.author === currentUser) profilePosts.innerHTML += html;
  });

  if (user.avatar) {
    avatar.innerHTML = `<img src="${user.avatar}">`;
  }
  bio.value = user.bio;

  profileGallery.innerHTML = user.gallery.map(m => m.type.startsWith('image') ? `<img class="media-item" src="${m.url}" onclick="openModal('${m.url}')">` : `<video class="media-item" src="${m.url}" controls onclick="openModal('${m.url}', true)"></video>`).join('');
}

function saveProfile() {
  user.bio = bio.value;
  const file = avatarInput.files[0];
  if (file) {
    const r = new FileReader();
    r.onload = e => {
      user.avatar = e.target.result;
      avatar.innerHTML = `<img src="${e.target.result}">`;
      saveData();
      render();
    };
    r.readAsDataURL(file);
  } else {
    saveData();
    render();
  }
}

function addProfileMedia() {
  Array.from(profileMediaInput.files).slice(0,4).forEach(file => {
    const r = new FileReader();
    r.onload = e => {
      user.gallery.push({type: file.type, url: e.target.result});
      saveData();
      render();
    };
    r.readAsDataURL(file);
  });
  profileMediaInput.value = '';
}

function openModal(url, isVideo = false) {
  const modal = document.getElementById('modal');
  const content = document.getElementById('modalContent');
  if (isVideo) {
    content.outerHTML = `<video id="modalContent" class="modal-content" src="${url}" controls autoplay></video>`;
  } else {
    content.src = url;
  }
  modal.style.display = 'flex';
}

function closeModal() {
  const modal = document.getElementById('modal');
  modal.style.display = 'none';
  const content = document.getElementById('modalContent');
  if (content.tagName === 'VIDEO') content.pause();
}

function toggleEmojiPicker(targetId) {
  const picker = document.getElementById('emojiPicker');
  picker.innerHTML = emojiList.map(e => `<button onclick="insertEmoji('${e}', '${targetId}')">${e}</button>`).join('');
  picker.style.display = picker.style.display === 'block' ? 'none' : 'block';
  picker.style.left = `${event.target.getBoundingClientRect().left}px`;
  picker.style.bottom = `${window.innerHeight - event.target.getBoundingClientRect().bottom + 10}px`;
}

function insertEmoji(emoji, targetId) {
  const target = document.getElementById(targetId);
  target.value += emoji;
  toggleEmojiPicker();
}

document.addEventListener('click', e => {
  if (!e.target.closest('.emoji-picker') && !e.target.closest('button[onclick^="toggleEmojiPicker"]')) {
    document.getElementById('emojiPicker').style.display = 'none';
  }
  if (!e.target.closest('.menu-box') && !e.target.closest('button[onclick^="toggleMenu"]')) {
    document.querySelectorAll('.menu-box').forEach(m => m.style.display = 'none');
  }
});
</script>
</body>
</html>
